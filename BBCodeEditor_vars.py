sc1 = '''
var domain,staticdomain,timeoutsec=30,FList={};FList.Common_highContrast=function(){var a=document.getElementById("hcmode");return a!==undefined&&a!==null?1:0};FList.Common_gettime=function(){var a="",b=new Date,c=b.getHours();a="PM";if(c<12)a="AM";if(c==0)c=12;if(c>12)c-=12;b=b.getMinutes();b+="";if(b.length==1)b="0"+b;return c+":"+b+" "+a};
FList.Common_getDate=function(a){var b="",c=a.getHours();b="PM";if(c<12)b="AM";if(c==0)c=12;if(c>12)c-=12;a=a.getMinutes();a+="";if(a.length==1)a="0"+a;return c+":"+a+" "+b};FList.Common_getmonth=function(a){var b=Array(12);b[0]="jan";b[1]="feb";b[2]="mar";b[3]="apr";b[4]="may";b[5]="jun";b[6]="jul";b[7]="aug";b[8]="sep";b[9]="oct";b[10]="nov";b[11]="dec";return b[a]};
$(document).ready(function(){domain="https://"+window.location.hostname+"/";staticdomain="https://static."+window.location.hostname.substring(4)+"/";FList.isSubscribed=parseInt($("#iss").val());FList.animatedIcons=parseInt($("#uai").val())==0?false:true;FList.inlineDisplayMode=parseInt($("#iim").val());$("input.NumbersOnly").bind("keypress",function(b){if(b.which!=8&&b.which!==0&&(b.which<48||b.which>57))return false});FList.Common_Autoselect();FList.Rights.load();$("#Page").css("height","600px");
var a=$("#Sidebar").width();$("#Content").css("min-width",869-(a==null?0:a)+"px")});FList.Common_Autoselect=function(){var a=FList.Common_getCookie("account_default_character_id");a!==0&&a>0&&$(".CharacterSelectBox").each(function(){$(this).children("option:selected").length==0&&$("option",this).each(function(){this.value==a&&$(this).attr("selected","selected")})})};FList.Common_equalHeight=function(a){a.height("");var b=0;a.each(function(){var c=$(this).height();if(c>b)b=c});a.height(b)};
FList.Common_dump=function(a,b){var c="";b||(b=0);for(var d="",e=0;e<b+1;e++)d+="    ";if(typeof a=="object")for(var f in a){e=a[f];c+=typeof e=="object"?d+"'"+f+"' ...\n"+FList.Common_dump(e,b+1):d+"'"+f+"' => \""+e+'"\n'}else c="===>"+a+"<===("+typeof a+")";return c};FList.Common_unixTimestamp=function(){return parseInt((new Date).getTime().toString().substring(0,10),10)};FList.Common_nl2br=function(a){return(a+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br />$2")};
FList.Common_multiLinePrompt=function(a,b,c,d){$(document.body).append('<div id="BlockUI"></div>');$(document.body).append('<div id="BlockUIInput" class="MediumPanel"></div>');$("#BlockUI, #BlockUIInput").hide();$("#BlockUIInput").html("<h3>"+a+'</h3><textarea id="BlockUIInputField">'+b+'</textarea><input type="button" value="'+c+'" id="BlockUIButton"/><input type="button" value="Cancel" id="BlockUICancelButton"/>');$("#BlockUIButton").bind("click",function(){$("#BlockUIInput").fadeOut("fast",function(){d($("#BlockUIInputField").val());
$(this).remove()});$("#BlockUI").fadeOut("fast",function(){$(this).remove()})});$("#BlockUICancelButton").bind("click",function(){$("#BlockUI, #BlockUIInput").fadeOut("fast",function(){$("#BlockUI, #BlockUIInput").remove()})});FList.Toolbars_Init();$("#BlockUI").css("width",$(window).width()+"px");$("#BlockUI").css("height",$(window).height()+"px");$("#BlockUI, #BlockUIInput").fadeIn("fast")};
FList.Common_setCookie=function(a,b,c){var d=new Date;d.setDate(d.getDate()+c);document.cookie=a+"="+escape(b)+(c==null?"":";expires="+d.toGMTString())};FList.Common_getCookie=function(a){if(document.cookie.length>0){c_start=document.cookie.indexOf(a+"=");if(c_start!=-1){c_start=c_start+a.length+1;c_end=document.cookie.indexOf(";",c_start);if(c_end==-1)c_end=document.cookie.length;return unescape(document.cookie.substring(c_start,c_end))}}return""};
FList.Common_ajax=function(a){$.ajax({type:typeof a.type=="undefined"?"GET":a.type,url:domain+a.url,dataType:"json",timeout:timeoutsec*1E3,data:a.data,success:function(b){if(b.error==""){typeof a.onSuccess!=="undefined"&&a.onSuccess(b);typeof a.onEither!=="undefined"&&a.onEither()}else{typeof a.onEither!=="undefined"&&a.onEither();typeof a.onError!=="undefined"&&a.onError(b.error);FList.Common_displayError("Error: "+b.error)}},error:function(b,c,d){typeof a.onError!=="undefined"&&a.onError(c+":"+
d);typeof a.onEither!=="undefined"&&a.onEither();FList.Common_displayError("Error: "+c+":"+d)}})};
FList.Friends_cancelPending=function(a){$.ajax({type:"POST",url:domain+"json/cancelFriendRequest.json",dataType:"json",timeout:timeoutsec*1E3,data:{request_id:a},success:function(b){if(b.error==""){FList.Common_displayNotice("Successfully cancelled this pending friend request.");$(".cancelpending"+a).slideUp("fast")}else FList.Common_displayError(b.error)},error:function(b,c,d){FList.Common_displayError(c+", "+d)}})};
FList.Common_getCharacters=function(){var a=[];$.each(characterdata,function(b,c){a.push({name:c.replace(/\+/g," "),id:b})});a.sort(function(b,c){if(b.name==c.name)return 0;return b.name>c.name?1:-1});return a};FList.Common_getCharacterSelectbox=function(a){var b=FList.Common_getCharacters(),c="<select class='CharacterSelectBox' id='"+a+"'>";$.each(b,function(d,e){c+="<option value='"+e.id+"'>"+e.name+"</option>"});c+="</select>";return c};
FList.Common_iSort=function(a){a.sort(function(b,c){var d=String(b).toLowerCase(),e=String(c).toLowerCase();if(d>e)return 1;if(d<e)return-1;return 0})};
FList.Friends_defriend=function(a,b){$.ajax({type:"POST",url:domain+"json/defriend.json",dataType:"json",timeout:timeoutsec*1E3,data:{source_character_id:a,dest_character_id:b},success:function(c){if(c.error==""){FList.Common_displayNotice("Successfully defriended this user.");$(".defriend"+a+"_"+b).slideUp("fast")}else FList.Common_displayError(c.error)},error:function(c,d,e){FList.Common_displayError(d+", "+e)}})};
FList.Friends_handleRequest=function(a,b,c){$.ajax({type:"POST",url:domain+"json/handleFriendRequest.json",dataType:"json",timeout:timeoutsec*1E3,data:{request_id:a,choice:b},success:function(d){if(d.error==""){b=="accept"?FList.Common_displayNotice(c+" has been added to your friends list."):FList.Common_displayNotice("The friend request by "+c+" was ignored.");$(".friendrequest"+a).slideUp("fast")}else alert("Error: "+d.error)},error:function(d,e,f){alert("Failed. Error:"+e+", "+f)}})};
$(function(){$("#NavigationSubscription").FlexMenu({items:[{text:"Subscriber Menu",type:"menu-header"},{text:"Settings",type:"menu-action",handler:function(){if(typeof FList.subsettingsdlg!=="undefined"){FList.subsettingsdlg.dialog("destroy");FList.subsettingsdlg.html("")}FList.Common_ajax({url:"json/subscription-info.json",type:"GET",data:{},onSuccess:function(c){FList.subsettingsdlg=$("<div class='StyledForm'><p><span class='label'>Subscription type</span><span class='element'>"+c.subscription_type+
"</span></p><p><span class='label'>Enable ads</span><span class='element'><input type='checkbox' id='subsettings-enableads' "+(c.enable_ads==1?"checked='checked'":"")+"/></span></p><p><span class='label'>Guestbook email-notifications</span><span class='element'><input type='checkbox' id='subsettings-gbook' "+(c.guestbook_notifications==1?"checked='checked'":"")+"/></span></p></div>");FList.subsettingsdlg.dialog({autoOpen:true,title:"Subscription Settings",width:"300",height:"250",modal:true,buttons:{Save:function(){FList.Common_ajax({url:"json/subscription-save.json",
type:"POST",data:{enableads:$("#subsettings-enableads:checked").length,gbooknotifications:$("#subsettings-gbook:checked").length},onSuccess:function(){FList.Common_displayNotice("Your subscription settings were saved.")},onError:function(d){FList.Common_displayError("Save failed: "+d)},onEither:function(){FList.subsettingsdlg.dialog("close")}})},Close:function(){FList.subsettingsdlg.dialog("close")}}})},onError:function(c){FList.Common_displayError("Loading subscription data failed: "+c)}})}},{text:"Discussion Group",
type:"menu-link",path:"group.php?group=subscribers"},{text:"Roleplay Ad",type:"menu-action",handler:function(){if(typeof FList.subaddlg!=="undefined"){FList.subaddlg.dialog("destroy");FList.subaddlg.html("")}FList.Common_ajax({url:"json/subscription-info.json",type:"GET",data:{},onSuccess:function(c){var d=FList.Common_getCharacterSelectbox("subad_linkedcharacter");FList.subaddlg=$("<div class='StyledForm'><p><span class='label'>Enabled</span><span class='element'><input type='checkbox' id='subad-enabled' "+
(c.personal_ad_enabled==1?"checked='checked'":"")+"/></span></p><p><span class='label'>Linked character</span><span class='element'>"+d+"</span></p><p><span class='label'>Ad</span><span class='element'><textarea id='subad-text'>"+c.personal_ad_text+"</textarea></span></p></div>");FList.subaddlg.dialog({autoOpen:true,title:"Roleplay Ad",width:"400",height:"320",modal:true,buttons:{Save:function(){FList.Common_ajax({url:"json/subscription-personalad-save.php",type:"POST",data:{linkedcharacter:$("#subad_linkedcharacter").val(),
enabled:$("#subad-enabled:checked").length,ad:$("#subad-text").val(),csrf_token:FList.csrf_token()},onSuccess:function(){FList.Common_displayNotice("Your roleplay ad was saved.")},onError:function(e){FList.Common_displayError("Save failed: "+e)},onEither:function(){FList.subaddlg.dialog("close")}})},Close:function(){FList.subaddlg.dialog("close")}}});c.ad_character_id!==0&&$("#subad_linkedcharacter option").each(function(){this.value==c.ad_character_id&&$(this).attr("selected","selected")})},onError:function(c){FList.Common_displayError("Loading roleplay ad failed: "+
c)}})}}]});$("#NavigationGroups").FlexMenu({items:[{text:"Groups",type:"menu-header"},{text:"F-List Discussion",type:"menu-link",path:"group.php?group=f-list"},{text:"F-Chat Discussion",type:"menu-link",path:"group.php?group=f-chat"},{text:"F-Chat Desktop Client",type:"menu-link",path:"group.php?group=f-chat%20desktop%20client"},{text:"Browse Groups",type:"menu-link",path:"group_browse.php"},{text:"Groups You Own",type:"menu-link",path:"group_manage.php"},{text:"Request Group",type:"menu-link",path:"group_create.php"}]});
$("#NavigationAccount").FlexMenu({items:[{text:"Account",type:"menu-header"},{text:"Settings",type:"menu-link",path:"account_settings.php"},{text:"Memo list",type:"menu-link",path:"experimental/memos.php"},{text:"Friends List",type:"menu-link",path:"friendslist.php"},{text:"Bookmarks List",type:"menu-link",path:"bookmarks.php"},{text:"Clean Up Bookmarks",type:"menu-link",path:"bookmark_cleanup.php"},{text:"Ignore List",type:"menu-link",path:"ignorelist.php"},{text:"Icon Gallery",type:"menu-link",
path:"icons.php"},{text:"Inline Images",type:"menu-link",path:"inlines.php"},{text:"Mass Delete Characters",type:"menu-link",path:"experimental/prefix_delete.php"}]});$("#NavigationHelp").FlexMenu({items:[{text:"Help and Info",type:"menu-header"},{text:"Documentation",type:"menu-label"},{text:"Getting Started with F-List and F-Chat",type:"menu-link-external",url:"https://wiki.f-list.net/Getting_started"},{text:"F-List and F-Chat's Rules",type:"menu-link-external",url:"https://wiki.f-list.net/Rules"},
{text:"FAQ/Troubleshooting",type:"menu-link-external",url:"https://wiki.f-list.net/Frequently_Asked_Questions"},{text:"Ask and Suggest",type:"menu-label"},{text:"Community Help Forum",type:"menu-link",path:"forum.php?forum=855.php"},{text:"Browse Bug Reports",type:"menu-link",path:"bugtracker.php"},{text:"Report a Bug/Technical Problem",type:"menu-link",path:"bugreports.php"},{text:"File a Ticket",type:"menu-link",path:"tickets.php"},{text:"Suggestions/Feature Requests",type:"menu-link",path:"vote.php"},
{text:"New Things",type:"menu-label"},{text:"Newspost Archive",type:"menu-link",path:"newsposts.php"},{text:"F-List Changelog",type:"menu-link",path:"changelog.php"}]});$("#NavigationChat").FlexMenu({items:[{text:"F-Chat",type:"menu-header"},{text:"F-Chat 1.0 Webclient",type:"menu-link",path:"fchat/"},{text:"F-Chat 2.0 Webclient",type:"menu-link",path:"chat/"},{text:"F-Chat Desktop Client",type:"menu-link",path:"forum.php?forum=1697"},{text:"Third-Party F-Chat Clients",type:"menu-link-external",url:"https://wiki.f-list.net/Third_party_clients"},
{text:"F-Chat Help",type:"menu-label"},{text:"Chat Help",type:"menu-link-external",url:"https://wiki.f-list.net/Frequently_Asked_Questions#Chat_Help"},{text:"Chat Command Reference",type:"menu-link-external",url:"https://wiki.f-list.net/F-Chat_Command_Reference"},{text:"List of Official Channels",type:"menu-link-external",url:"https://wiki.f-list.net/F-Chat_Official_Channels"},{text:"Chat Stats",type:"menu-link-external",url:"http://chat.f-list.net:9002/stats/"}]});var a=[{text:"Characters",type:"menu-header"},
{text:"Create a new character",type:"menu-link",path:"character_create.php",fixed:true},{text:"Browse New",type:"menu-link",path:"character_browse.php",fixed:true},{text:"Character Gallery",type:"menu-link",path:"experimental/gallery.php",fixed:true},{text:"Roleplay Ads",type:"menu-link",path:"character_personals.php",fixed:true},{text:"Search Characters",type:"menu-link",path:"search.php",fixed:true},{text:"Image Search",type:"menu-link",path:"experimental/search.php",fixed:true},{text:"Copy Kinks",
type:"menu-action",fixed:true,handler:function(){if(typeof FList.copykinksdlg!=="undefined"){FList.copykinksdlg.dialog("destroy");FList.copykinksdlg.html("")}var c=FList.Common_getCharacterSelectbox("copykinks_source"),d=FList.Common_getCharacterSelectbox("copykinks_dest");FList.copykinksdlg=$("<div class='StyledForm'><p><b>Warning:</b> <i>This will remove any kinks at the destination character.</i> <p><i>Ensure you are <b>not</b> editing the character you are copying kinks to when clicking &quot;Copy&quot;. Otherwise, the copied kinks may be lost.</i></p><p><span class='label'>Source</span><span class='element'>"+
c+"</span></p><p><span class='label'>Destination</span><span class='element'>"+d+"</span></p></div>");FList.copykinksdlg.dialog({autoOpen:true,title:"Copy Kinks",width:"320",height:"240",modal:true,buttons:[{id:"dialog-copy-copy",text:"Copy",click:function(){$("#dialog-copy-copy").button("option","label","Copying...");$("#dialog-copy-copy, #dialog-copy-cancel").button("disable");FList.Common_ajax({url:"json/character-copy-kinks.json",type:"POST",data:{source:$("#copykinks_source").val(),dest:$("#copykinks_dest").val()},
onSuccess:function(e){FList.copykinksdlg.dialog("close");FList.Common_displayNotice("Your kinks were copied from "+e.source+" to "+e.dest+".")},onError:function(e){FList.Common_displayError("Transfer failed: "+e)},onEither:function(){$("#dialog-copy-copy, #dialog-copy-cancel").button("enable");$("#dialog-copy-copy").button("option","label","Copy")}})}},{id:"dialog-copy-cancel",text:"Cancel",click:function(){FList.copykinksdlg.dialog("close")}}]})}},{text:"Purge Kinks",type:"menu-action",fixed:true,
handler:function(){if(typeof FList.purgekinksdlg!=="undefined"){FList.purgekinksdlg.dialog("destroy");FList.purgekinksdlg.html("")}var c=FList.Common_getCharacterSelectbox("purgekinks_chara");FList.purgekinksdlg=$("<div class='StyledForm'><p><span class='label'>Select character</span><span class='element'>"+c+"</span></p></div>");FList.purgekinksdlg.dialog({autoOpen:true,title:"Purge Kinks",width:"340",height:"180",modal:true,buttons:{Purge:function(){FList.Common_ajax({url:"json/character-purge-kinks.json",
type:"POST",data:{character:$("#purgekinks_chara").val()},onSuccess:function(){FList.Common_displayNotice("Your kinks were purged from "+$("#purgekinks_chara option:selected").text()+".")},onError:function(d){FList.Common_displayError("Purge failed: "+d)},onEither:function(){FList.purgekinksdlg.dialog("close")}})},Cancel:function(){FList.purgekinksdlg.dialog("close")}}})}},{text:"Rename a Character",type:"menu-link",path:"experimental/rename.php",fixed:true},{text:"Your Characters",type:"menu-link",
path:"character_list.php",fixed:true}],b=FList.Common_getCharacters();$.each(b,function(c,d){a.push({text:d.name,type:"menu-link",path:"c/"+d.name.toLowerCase()+"/",subItems:[{align:"right",icon:staticdomain+"images/icons/cross-button-black.png",handler:function(){FList.Character_deleteCharacter(d.id,d.name)}},{align:"left",icon:staticdomain+"images/icons/pencil.png",url:domain+"character_edit.php?id="+d.id}]})});$("#NavigationCharList").FlexMenu({items:a})});
FList.Memo={dlg:0,prepareData:function(a,b){$.ajax({type:"GET",url:domain+"json/character-memo-get.json",dataType:"json",timeout:timeoutsec*1E3,data:{target:a},success:function(c){c.error==""?FList.Memo.showEditDialog(c.id,c.note,a,b):FList.Common_displayError("Load failed: "+c.error)},error:function(c,d,e){FList.Common_displayError("An error occured. "+d+":"+e)}})},showEditDialog:function(a,b,c,d){if(FList.Memo.dlg!==0){FList.Memo.dlg.dialog("destroy");FList.Memo.dlg=0}FList.Memo.dlg=$("<div>A memo is a note you store on a profile for something you want to write down about this person. Only you can see it.<br/><textarea class='ui-current-memo' style='width:300px;height:150px;' maxlength='1000'>"+
b+"</textarea></div>");FList.Memo.dlg.dialog({autoOpen:true,title:"Edit memo for "+c,width:"350",height:"315",modal:true,buttons:{Save:function(){var e=FList.Memo.dlg.find(".ui-current-memo").val();$.ajax({type:"POST",url:domain+"json/character-memo-save.json",dataType:"json",timeout:timeoutsec*1E3,data:{target:a,note:e},success:function(f){if(f.error==""){FList.Memo.dlg.dialog("close");FList.Common_displayNotice("Your memo was saved.");typeof d!=="undefined"&&d({type:"changed",data:f.note})}else{FList.Common_displayError("Save failed: "+
f.error);typeof d!=="undefined"&&d({type:"error"})}},error:function(f,g,m){FList.Common_displayError("An error occured. "+g+":"+m);typeof d!=="undefined"&&d({type:"error"})}})},Close:function(){FList.Memo.dlg.dialog("close");typeof d!=="undefined"&&d({type:"cancel"})}}})}};
FList.Common_replyComment=function(a,b,c){$(".replybox").remove();var d=$("#Comment"+a).css("margin-left");$("<div style='margin-left:"+d+";' class='replybox replybox"+a+"'><a class='close' onclick=\"$('.replybox"+a+"').slideUp('fast',function(){$(this).remove();});\"></a><div class='sel'></div><textarea></textarea><input type='button' class='post' value='Post Reply'/></div>").insertAfter("#Comment"+a).hide().slideDown("fast");d=FList.Common_getCharacterSelectbox("comment_reply_active");$(".replybox"+
a+" .sel").html(d);$("#comment_reply_active").val($("#def").val());$(".replybox input").click(function(){$(this).val("Posting...").attr("disabled",true);var e=$(".replybox"+a+" .sel select").val(),f=$(".replybox textarea").val();FList.Common_postComment(b,f,e,a,c)})};
FList.Common_saveComment=function(a){$("#Comment"+a+" textarea").slideUp("fast",function(){var b=$("#Comment"+a+" textarea").val();$("#SaveCommentLink"+a).addClass("Busy");$.ajax({type:"POST",url:domain+"json/saveComment.json",dataType:"json",timeout:timeoutsec*1E3,data:{comment_id:a,message:b},success:function(c){$("#SaveCommentLink"+a).removeClass("Busy");if(c.error==""){$("#Comment"+a+" .message").html(FList.TagParser.parseContent(htmlentities(c.message)));$("#Comment"+a+" .edit").show();$("#Comment"+
a+" .save").hide();$("#Comment"+a+" .message").slideDown("fast")}else{$("#SaveCommentLink"+a).removeClass("Busy");FList.Common_displayError(c.error)}},error:function(c,d,e){$("#SaveCommentLink"+a).removeClass("Busy");FList.Common_displayError("Deleting comment failed; "+d+", "+e)}})})};
FList.Common_deleteComment=function(a){if(confirm("Are you sure you want to delete this comment?")){$("#DeleteCommentLink"+a).addClass("Busy");$.ajax({type:"GET",url:domain+"json/deleteComment.json",dataType:"json",timeout:timeoutsec*1E3,data:{comment_id:a},success:function(b){if(b.error==""){$("#DeleteCommentLink"+a).removeClass("Busy");$("#Comment"+a).hide("fast",function(){$(this).remove()})}else{$("#DeleteCommentLink"+a).removeClass("Busy");FList.Common_displayError(b.error)}},error:function(b,
c,d){$("#DeleteCommentLink"+a).removeClass("Busy");FList.Common_displayError("Deleting comment failed; "+c+", "+d)}})}};
FList.Common_editComment=function(a,b){$("#EditCommentLink"+a).addClass("Busy");$.ajax({type:"GET",url:domain+"json/getComment.json",dataType:"json",timeout:timeoutsec*1E3,data:{comment_id:a,target_id:b},success:function(c){$("#EditCommentLink"+a).removeClass("Busy");if(c.error==""){c=c.message;$("#Comment"+a+" .message").html("<textarea></textarea>");var d=$("#Comment"+a).width()-65;$("#Comment"+a+" textarea").val(htmlspecialchars_decode(c)).hide().css("width",d+"px").slideDown("fast");$("#Comment"+
a+" .edit").hide();$("#Comment"+a+" .save").show()}else{$("#EditCommentLink"+a).removeClass("Busy");FList.Common_displayError(c.error)}},error:function(c,d,e){$("#EditCommentLink"+a).removeClass("Busy");FList.Common_displayError("Deleting comment failed; "+d+", "+e)}})};
FList.Common_postComment=function(a,b,c,d,e,f){if(typeof d==="undefined")d=0;$.ajax({type:"POST",url:domain+"json/postComment.json",dataType:"json",timeout:timeoutsec*1E3,data:{target_id:a,message:b,character_id:c,replyto:d,type:e,csrf_token:FList.csrf_token()},success:function(g){d!==0&&$(".replybox"+d+" .post").val("Post Reply");if(g.error==""){typeof f!=="undefined"&&f(true);$("#VarCommentMessage").val("");FList.Common_addComment(g.id,d,a,e)}else{d!==0&&$(".replybox"+d+" input").attr("disabled",
false);typeof f!=="undefined"&&f(false);FList.Common_displayError("Posting comment failed on server; "+g.error)}},error:function(g,m,r){d!==0&&$(".replybox"+d+" input").attr("disabled",false).val("Post Reply");typeof f!=="undefined"&&f(false);FList.Common_displayError("Posting comment failed; "+m+":"+r)}})};
FList.Common_addComment=function(a,b,c,d){$(".NewCommentHeader").addClass("Busy");$.ajax({type:"GET",url:domain+"json/getComment.json",dataType:"json",timeout:timeoutsec*1E3,data:{target_id:c,comment_id:a},success:function(e){$(".NewCommentHeader").removeClass("Busy");if(e.error==""){$(".NestedComment").length==0&&$("#CommentsBox").html("");e.message=FList.TagParser.parseContent(e.message);e=$("<div class='NestedComment' style='margin-left:"+(e.level*20-10+"px")+";' id='Comment"+e.comment_id+"'><a name='Comment"+
e.comment_id+"'></a><a href='"+domain+"c/"+e.friendlyname+"' class='CommentAvatarLink'><img src='"+staticdomain+"images/avatar/"+e.friendlyname+".png' class='CommentAvatar'/></a><a href='#Comment"+e.comment_id+"' class='ParsedLink ImageLink'></a> Comment by <a class='ImageLink CharacterLink' href='"+domain+"c/"+e.friendlyname+"'>"+e.name+"</a> posted <span class='Comment_Datetime'>"+e.datetime_posted+"</span><br/><div class='message'>"+e.message+"</div><div class='actions'><a class='ImageLink reply' id='ReplyCommentLink"+
e.comment_id+"' onclick=\"FList.Common_replyComment("+e.comment_id+","+c+",'"+d+"');\">Reply</a><a class='ImageLink edit' id='EditCommentLink"+e.comment_id+"' onclick=\"FList.Common_editComment("+e.comment_id+","+c+");\">Edit</a><a class='ImageLink save' id='SaveCommentLink"+e.comment_id+"' onclick=\"FList.Common_saveComment("+e.comment_id+","+c+");\">Save</a><a class='ImageLink delete' id='DeleteCommentLink"+e.comment_id+"' onclick=\"FList.Common_deleteComment("+e.comment_id+","+c+');">Delete</a></div></div>');
if(b==0)$("#CommentsBox").append(e);else{$("#Comment"+b).after(e);$(".replybox"+b).slideUp("fast",function(){$(this).remove()})}$(".NestedComment:last").hide();$(".NestedComment:last").fadeIn("fast")}else FList.Common_displayError("Error: "+e.error)},error:function(e,f,g){$(".NewCommentHeader").removeClass("Busy");FList.Common_displayError("Retrieving comments failed; "+f+":"+g)}})};FList.csrf_token=function(){return $("#flcsrf-token").attr("content")};
FList.Rights={raw:0,list:{admin:1,"chat-chatop":2,"chat-chanop":4,"helpdesk-chat":8,"helpdesk-general":16,"moderation-site":32,reserved:64,"misc-grouprequests":128,"misc-newsposts":256,"misc-changelog":512,"misc-featurerequests":1024,"dev-bugreports":2048,"dev-tags":4096,"dev-kinks":8192,developer:16384,tester:32768,subscriptions:65536,"former-staff":131072},load:function(){FList.Rights.raw=$("#perm").val()},has:function(a){return FList.Rights.raw&FList.Rights.list[a]}};var infotag_search=[];infotag_search[1]="age";infotag_search[2]="orientation";infotag_search[3]="gender";infotag_search[5]="msn";infotag_search[6]="aim";infotag_search[7]="yahoo";infotag_search[9]="species";infotag_search[10]="cock_diameter";infotag_search[11]="cock_length";infotag_search[12]="height";infotag_search[13]="build";infotag_search[14]="occupation";infotag_search[15]="domsub_role";infotag_search[16]="ball_size";infotag_search[17]="eye_color";infotag_search[18]="hair";
infotag_search[19]="body_color";infotag_search[20]="weight";infotag_search[21]="icq";infotag_search[22]="jabber";infotag_search[23]="irc";infotag_search[24]="post_length";infotag_search[25]="rp_length";infotag_search[27]="breast_size";infotag_search[28]="location";infotag_search[29]="furrypref";infotag_search[30]="website";infotag_search[31]="uncut";infotag_search[32]="cock_shape";infotag_search[33]="skype";infotag_search[34]="tapestries";infotag_search[35]="cock_color";infotag_search[36]="sheath";
infotag_search[38]="barbed";infotag_search[39]="knotted";infotag_search[40]="knot_diameter";infotag_search[41]="position";infotag_search[42]="relationship";infotag_search[43]="furcadia";infotag_search[44]="email";infotag_search[45]="cumshot_size";infotag_search[47]="secondlife";infotag_search[48]="steam";infotag_search[49]="language";infotag_search[50]="twitter";infotag_search[51]="body_type";infotag_search[52]="shangrila";infotag_search[53]="furaffinity";infotag_search[54]="inkbunny";
infotag_search[55]="personality";infotag_search[56]="trillian";infotag_search[57]="houseeros";infotag_search[59]="rabbithole";infotag_search[60]="post_perspective";infotag_search[61]="xbox_live";infotag_search[62]="playstation";infotag_search[63]="looking_for";infotag_search[64]="visible_age";infotag_search[65]="rp_method";infotag_search[66]="deviantart";infotag_search[67]="grammar_comp";infotag_search[68]="grammar_required";infotag_search[69]="measurements";infotag_search[70]="nipple_color";
infotag_search[71]="body_mods";infotag_search[72]="vulva_type";infotag_search[74]="wow";infotag_search[75]="public_hair";infotag_search[79]="imvu";infotag_search[80]="formspring";var curGroup,curInfotagList,queryParts=[],fetishParts=[],searchmode="profiles";function toggleSearchAdvanced(a){a?$(".SearchAdvanced").show():$(".SearchAdvanced").hide()}function inGroup(a){if(a==undefined)return false;return a.group==curGroup}
function inInfotagList(a){if(a==undefined)return false;return a.name==curInfotagList}function nameSort(a,b){var c=a.name.toLowerCase(),d=b.name.toLowerCase();if(c<d)return-1;if(c>d)return 1;return 0}
function buildSearchQuery(){var a=[],b=$("#VarCharacterName").val().replace(/(:|\(|\))/g,"\\$1"),c=$("#VarCharacterDescription").val().replace(/(:|\(|\))/g,"\\$1"),d=$("#VarCharacterCustom").val().replace(/(:|\(|\))/g,"\\$1"),e=$("#VarCharacterExistsSince").val();if(e.length){e=Math.round((new Date).getTime()/1E3)-Number(e)*86400;a.push("(creation_date: ["+e+" TO *])")}b.length&&a.push("(name: ("+b+"))");c.length&&a.push("(description: ("+c+"))");d.length&&a.push("(custom_fetish: ("+d+"))");c=[];
for(b=0;b<fetishParts.length;++b){d=fetishParts[b];e=[];if(typeof d=="object")if(!d.empty){for(var f=0;f<d.choices.length;++f)e.push(d.choices[f]+"\\|"+d.fetish_id);c.push("("+e.join(" || ")+")")}}c.length&&a.push("(fetish: ("+c.join(" && ")+"))");for(b=0;b<queryParts.length;++b){c="";d=queryParts[b];if(typeof d=="object")if(!d.empty){c+=d.not?"NOT (":"(";c+=d.name+": ";switch(d.type){case "list":c+="("+d.data.join(" || ")+")";break;case "text":case "range":c+=d.data}c+=")";a.push(c)}}a=a.join(" ");
$("#SearchTermsBox").val(a)}function getQueryPart(a,b,c){switch(c){case "list":if(typeof queryParts[b]!="object")queryParts[b]={type:"list",id:b,name:a,empty:true,data:[],not:false};break;case "text":if(typeof queryParts[b]!="object")queryParts[b]={type:"text",id:b,name:a,empty:true,data:"",not:false};break;case "range":if(typeof queryParts[b]!="object")queryParts[b]={type:"range",id:b,name:a,empty:true,data:"",not:false}}return queryParts[b]}
function searchNOTchanged(a,b,c,d){a=getQueryPart(a,c,b);a.not=d;queryParts[c]=a;buildSearchQuery()}function searchCheckboxUpdate(a,b){var c=getQueryPart(infotag_search[a],a,"list");c.data=[];var d=$(b).multiselect("getChecked").map(function(){return this.value}).get();$.each(d,function(e,f){c.data.push(f)});c.empty=c.data.length?false:true;queryParts[a]=c;buildSearchQuery()}
function searchTextUpdate(a,b,c){a=getQueryPart(a,b,"text");a.data=c.replace(/(:|\(|\))/g,"\\$1");a.empty=c.length?false:true;queryParts[b]=a;buildSearchQuery()}function searchRangeUpdate(a,b){var c=getQueryPart(a,b,"range"),d=$("#VarCharacterSearchRangeLow"+b).val(),e=$("#VarCharacterSearchRangeHigh"+b).val(),f="[";f+=d.length?d:"*";f+=" TO ";f+=e.length?e:"*";f+="]";c.data=f;c.empty=d.length|e.length?false:true;queryParts[b]=c;buildSearchQuery()}
function getInfotag(a){var b='<p><span class="label"><span class="SearchAdvanced"><input type="checkbox" value="NOT" onclick="searchNOTchanged(\''+infotag_search[a.id]+"','"+a.type+"',"+a.id+',this.checked);"i/>NOT</span> '+a.name+"</span>";if(a.type=="list"){b+='<span class="element">';curInfotagList=a.list;var c=jQuery.grep(listitems,inInfotagList);b+='<select multiple="multiple" class="multiple" rel="'+a.id+'">';jQuery.each(c,function(d,e){b+="<option  value="+e.id+">"+e.value+"</option>"});b+=
"</select>"}else if(a.type=="range"){b+='<span class="element"><input style="width:40px;" type="text" id="VarCharacterSearchRangeLow'+a.id+'" onkeyup="searchRangeUpdate(\''+infotag_search[a.id]+"',"+a.id+');return true;"/> to ';b+='<input style="width:40px;" type="text" id="VarCharacterSearchRangeHigh'+a.id+'" onkeyup="searchRangeUpdate(\''+infotag_search[a.id]+"',"+a.id+');return true;"/>'}else b+='<span class="element"><input type="text" onkeyup="searchTextUpdate(\''+infotag_search[a.id]+"',"+a.id+
',this.value);return true;"/>';b+="</span></p>";return b}function updateFetishChoice(a,b){var c=fetishParts[a];if(typeof c!="object")alert("Something went horribly wrong with updating a fetish choice.");else{c.fetish_id=b;fetishParts[a]=c;buildSearchQuery()}}function updateFetish(a,b,c){var d=fetishParts[a];if(c)$.inArray(b,d.choices)==-1&&d.choices.push(b);else{b=$.inArray(b,d.choices);b!=-1&&d.choices.splice(b,1)}d.empty=d.choices.length?false:true;fetishParts[a]=d;buildSearchQuery()}
function addFetish(){if(FList.Search_searchCount>=25)FList.Common_displayError("You can't search for more than twenty-five terms.");else{$("#Search_FetishBox").append("<div class='Search_Fetish' id='Search_Fetish"+fetishParts.length+"'></div>");$("#Search_Fetish"+fetishParts.length).append('<select name="search[]" style="width:auto;" class="Search" id="Search'+fetishParts.length+'" onchange="updateFetishChoice('+fetishParts.length+',Number(this.options[this.selectedIndex].value))"></select> <a href="#" onclick="removeFetish('+
fetishParts.length+');">Remove</a>');$("#Search"+fetishParts.length).html($("#KinkData").html());$("#Search_Fetish"+fetishParts.length).append('<p><span class="element"><input type="checkbox" onclick="updateFetish('+fetishParts.length+',\'fave\',this.checked)"> Favorite <input type="checkbox" onclick="updateFetish('+fetishParts.length+',\'yes\',this.checked)"> Yes <input type="checkbox" onclick="updateFetish('+fetishParts.length+',\'maybe\',this.checked)"> Maybe <input type="checkbox" onclick="updateFetish('+
fetishParts.length+",'no',this.checked)\"> No</span></p>").show();FList.Search_searchCount++;$("#Search_Fetishcount").html(FList.Search_searchCount+" Kinks");fetishParts.push({id:fetishParts.length,fetish_id:77,choices:[],empty:true})}}function removeFetish(a){fetishParts[a]=undefined;FList.Search_searchCount--;$("#Search_Fetish"+a).remove();$("#Search_Fetishcount").html(FList.Search_searchCount+" Kinks");buildSearchQuery()}
FList.Search_makeGroupItems=function(a){var b='<div><h3><a href="#">';curGroup=a;var c=jQuery.grep(infotags,inGroup);c.sort(nameSort);switch(a){case 1:b+="Contact Details</a></h3>";break;case 2:b+="Sexual Details</a></h3>";break;case 3:b+="General Details</a></h3>";break;case 5:b+="RP Preferences</a></h3>"}b+="<div>";jQuery.each(c,function(d,e){if(typeof infotag_search[e.id]!="undefined")b+=getInfotag(e)});b+="</div></div>";$("#SearchAccordion").append(b)};
FList.Search_previousPage=function(){if(FList.Search_resultspage>0){FList.Search_resultspage--;FList.Search_doSearch()}};FList.Search_nextPage=function(){FList.Search_resultspage++;FList.Search_doSearch()};FList.Search_newSearch=function(){FList.Search_resultspage=0;FList.Search_doSearch()};
FList.Search_results=function(a){$("#Search_ResultsBox").html("");if(searchmode=="profiles")$.each(a.listing,function(c,d){$("#Search_ResultsBox").append('<a href="'+domain+"c/"+d.name.toLowerCase()+'/" target="_blank" class="ListedCharacter ListedCharacter'+d.id+'"><img src="'+staticdomain+"images/avatar/"+d.name.toLowerCase()+'.png" style="float:left;width:50px;margin-right:8px;"/><span class="ImageLink ResultListingName CharacterLink">'+d.name+"</span><br /></a>");d.last_online!=0&&$(".ListedCharacter"+
d.id).append("<b>Last Online:</b> "+d.last_online+"<br/>");var e=[];$.each(d.properties,function(f,g){var m=$.inArray(f,infotag_search);if(m!=-1){f=infotags[m].name;if(infotags[m].type=="list"&&typeof listitems[g]=="object")g=listitems[g].value;e.push("<b>"+f+":</b> "+g)}});e.sort();for(c=0;c<e.length;++c)$(".ListedCharacter"+d.id).append("<span class='ResultListingItem'>"+e[c]+"</span>")});else{var b=[];$.each(a.listing,function(c,d){b.push(d.id)});$.ajax({type:"GET",url:domain+"json/getCharacterImages.json",
dataType:"json",timeout:timeoutsec*1E3,data:{ids:b},success:function(c){$("#Search_ResultsBox").html("").css("text-align","center");if(c.error==""){$.each(c.images,function(d,e){var f=parseInt(e.width),g=parseInt(e.height);if(f>g){f=parseFloat(f/g);g=parseInt(parseFloat(100)/f);f=100}else if(f==g)f=g=100;else{f=g/f;f=parseInt(100/f);g=100}var m=parseInt((100-g)/2+10);$("#Search_ResultsBox").append('<a href="'+domain+"c/"+e.name+'" target="_blank"><img class="thumbnail im'+e.image_id+'" src="'+staticdomain+
"images/charthumb/"+e.image_id+"."+e.extension+'"/></a>');$(".im"+e.image_id).css("width",f+"px");$(".im"+e.image_id).css("height",g+"px");$(".im"+e.image_id).css("margin-top",m+"px");$(".im"+e.image_id).css("margin-bottom",m+"px")});$("#Search_ResultsBox").show()}else $("#Search_ResultsBox").html("<div id='DisplayedMessage'>"+c.error+"</div>");$("#Search_Resultsheader").removeClass("Busy")},error:function(c,d,e){FList.Common_displayError("Search failed; "+d+":"+e)}})}};
FList.Search_doSearch=function(){if(!$("#Search_Results").is(":visible")){$("#Search_Results").show();$("#Search_ResultsBox").show()}$("#Search_ResultsBox").html("Now Searching...");var a=$("#SearchTermsBox").val(),b=parseInt($("#VarCharacterOnlineSince").val());$.ajax({type:"POST",url:domain+"json/searchCharacters2.json",dataType:"json",timeout:timeoutsec*1E3,data:{offset:FList.Search_resultspage*10,query:a,online_days:b},success:function(c){if(c.error==""){$("#Search_Offset").html(" - page "+(FList.Search_resultspage+
1)+" of "+Math.ceil(parseInt(c.total)/10));FList.Search_results(c)}else $("#Search_ResultsBox").html("<div id='DisplayedMessage'>"+c.error+"</div>");$("#Search_Resultsheader").removeClass("Busy")},error:function(c,d,e){FList.Common_displayError("Search failed; "+d+":"+e)}})};FList.Translation={};
FList.Translation.showKinkTranslationBox=function(a){clearTimeout(FList.Translation.fadeTimeout);$("#KinkTranslationDialog")&&$("#KinkTranslationDialog").remove();var b=$('<div id="KinkTranslationDialog" class="MediumPanel" style="border: 2px solid black"></div>');b.css("position","fixed");b.css("z-index","100");b.css("width","600");b.css("top","10%");b.css("left","10%");b.css("display","hidden");$("#Content").append(b);$('<img src="'+staticdomain+'images/icons/cross-circle-frame.png" alt="Close Preview" style="cursor: pointer;"/>').click(function(){b.fadeOut("fast").remove()});var c=
$("#Character_ListedFetish"+a).text(),d=$("#Character_ListedFetish"+a).attr("rel");b.append("<b>\u00dcbersetze Fetisch: "+c+"</b>");b.append('<p style="font-size: 0.9em">'+d+"</p>");b.append("<br/>");b.append('Fetisch-Name: <br/> <input type="text" size="40" id="KinkTranslationDialogKinkName" /><br/>');b.append('Beschreibung: <br/> <textarea style="height: 5em;" id="KinkTranslationDialogDescription"></textarea><br/>');b.append("<br/><p>Bitte treibe keinen Unfug - dein Accountname wird zu jeder eingereichten \u00dcbersetzung gespeichert. Eingereichte \u00dcbersetzungen sind sofort f\u00fcr Andere sichtbar und erscheinen beim Aktualisieren der Seite. Wenn es f\u00fcr einen englischen Begriff keine gel\u00e4ufige deutsche \u00dcbersetzung gibt, empfehlen wir, den englischen Begriff zu kopieren und ihn in der Beschreibung zu erkl\u00e4ren.</p>");
b.append("<br/>");c=$("<button>Abbrechen</button>");c.click(function(){b.fadeOut("fast").remove()});d=$("<button>\u00dcbersetzung einreichen</button>");d.click(function(){FList.Translation.submitKinkTranslation(a)});b.append(d);b.append("&nbsp;&nbsp;&nbsp;");b.append(c);b.fadeIn("fast")};
FList.Translation.submitKinkTranslation=function(a){var b=$("#KinkTranslationDialogKinkName").val(),c=$("#KinkTranslationDialogDescription").val(),d=$("#KinkTranslationDialog");d.empty();d.css("text-align","center");d.css("vertical-align","middle");d.html('<span class="Busy" style="height:18px;padding-left: 20px">\u00dcbertrage...</span>');$.getJSON(domain+"json/submitTranslation.json",{kink_id:a,kink_name:b,kink_description:c},function(){d.html('<span style="font-size: 2em">Vielen Dank!</span>');
FList.Translation.fadeTimeout=setTimeout(function(){d.fadeOut("fast").remove()},1E3)})};FList.Translation.init=function(){$("#Character_FetishList a.Character_ListedFetish").each(function(a,b){b=$(b);var c=b.attr("id").substr(22);b.dblclick(function(){FList.Translation.showKinkTranslationBox(c)})})};var noticeTimer;FList.Common_displayError=function(a){$("#ErrorBox").length==0&&$(document.body).append("<div id='ErrorBox'></div>");$("#ErrorBox").html("<a class='close'></a><b>Error:</b> "+a);$("#ErrorBox").is(":visible")||$("#ErrorBox").fadeIn("fast");var b=setTimeout("$('#ErrorBox').fadeOut('slow');",2E4);$("#ErrorBox a.close").click(function(){$("#ErrorBox").fadeOut("fast");clearTimeout(b)})};
FList.Common_displayWarning=function(a){$("#WarningBox").length==0&&$(document.body).append("<div id='WarningBox'></div>");$("#WarningBox").html("<a class='close'></a><b>Warning:</b> "+a);$("#WarningBox").is(":visible")||$("#WarningBox").fadeIn("fast");$("#WarningBox a.close").click(function(){$("#WarningBox").fadeOut("fast")})};FList.Common_hideWarning=function(){$("#WarningBox").length!=0&&$("#WarningBox").is(":visible")&&$("#WarningBox").fadeOut("fast")};
FList.Common_displayNotice=function(a,b){var c=false;if(typeof b!=="undefined")c=b;$("#Notice").length==0&&$(document.body).append('<div id="Notice"></div>');c?$("#Notice").html(a):$("#Notice").html("<a class='close'></a>"+a);$("#Notice").hide();$("#Notice").fadeIn("fast");clearTimeout(noticeTimer);noticeTimer=setTimeout("$('#Notice').fadeOut('slow');",1E4);c?$("#Notice").click(function(){$("#Notice").fadeOut("fast");clearTimeout(noticeTimer)}):$("#Notice a.close").click(function(){$("#Notice").fadeOut("fast");
clearTimeout(noticeTimer)})};$(document).ready(function(){noticeTimer=setTimeout("$('#Notice').fadeOut('slow');",1E4);$("#Notice a.close").click(function(){$("#Notice").fadeOut("fast");clearTimeout(noticeTimer)});FList.Common_currentTooltip=0});FList.BBParser=function(){var a={};a._urlregex=/^\s*((?:https?|ftps?|irc):\/\/[^\s\/$.?#"'].[^\s]*)\s*$/;a.validateURL=function(h){return a._urlregex.test(h)};a.unescapeURL=function(h){h.replace(/\"/g,"&quot;");h.replace(/\'/g,"&#39;");h.replace(/\</g,"&lt;");h.replace(/\>/g,"&gt;");var k=document.createElement("div");k.innerHTML=h;return k.textContent};var b={noparse:{render:function(h){return h},allowed:false},b:{opentag:"strong",closetag:"strong",allowed:true},i:{opentag:"em",closetag:"em",allowed:true},
u:{opentag:'span style="text-decoration:underline;"',closetag:"span",allowed:true},s:{opentag:"del",closetag:"del",allowed:true},sub:{opentag:"sub",closetag:"sub",allowed:["b","i","u"]},sup:{opentag:"sup",closetag:"sup",allowed:["b","i","u"]},url:{render:function(h,k){if(typeof h==undefined||h.length==0){h=k;k=undefined}if(typeof k!="undefined"){k=k.replace(/ /g,"%20");if(a.validateURL(k)&&!a.validateURL(h)){var l=a._urlregex.exec(k),n=l[1].match(/(https?|ftps?|irc):\/\/(?:www.)?([^\/]+)/)[2],o=document.createElement("div"),
p=document.createElement("a");p.href=a.unescapeURL(l[1]);p.className="ParsedLink ImageLink";p.target="_blank";p.textContent=h.replace(/&amp;/g,"&");o.appendChild(p);return o.innerHTML+' <span style="font-size: 0.8em;">['+n+"]</span>"}else return"[bad url: "+k+"] "+h}else if(a.validateURL(h)){l=a._urlregex.exec(h);o=document.createElement("div");p=document.createElement("a");p.href=a.unescapeURL(l[1]);p.className="ParsedLink ImageLink";p.target="_blank";p.textContent=l[1].replace(/&amp;/g,"&");o.appendChild(p);
return o.innerHTML}else return"[bad url: "+h+"] "},allowed:false},color:{render:function(h,k){return'<span style="color:'+k+';">'+h+"</span>"},allowed:true}},c=null,d=null,e=false,f=null,g=/(\[[\[ \/]*)([^\[\]]+)([\] ]*\])/,m=false,r="Text cut: too long.",s=function(h,k){for(var l=0;l<k.length;l++)if(k[l]==h)return true;return false},x=function(h,k){if(!b[k])return true;k=b[k].allowed;if(h==true&&k==true)return true;if(typeof k=="undefined")return h;if(h==false)return false;for(var l=[],n=0;n<k.length;n++)if(h==
true||s(h,k[n]))l.push(k[n]);return l.length==0?false:l},v=function(h,k,l){if(h instanceof Array){k="";for(var n=0;n<h.length;n++)k+=v(h[n],l,x(l,h[n].tagname));return k}if(h.tagname=="text"){if(m&&/\w{50,}/.test(c.substring(h.start,h.end)))return r;return c.substring(h.start,h.end)}if(h.tagname&&k!=false&&(k==true||s(h.tagname,k))){n=b[h.tagname];if(!h.content)return"";k=v(h.content,k,l);return typeof n.render=="function"?n.render(k,h.attribute):"<"+n.opentag+">"+k+"</"+n.closetag+">"}else e&&h.tagname&&
f.push("The ["+h.tagname+"] tag is not allowed here: "+c.substr(h.start,60)+"...");return c.substring(h.start,h.end)},w=function(h,k,l){for(var n=0;n<h.length;n++){if(h[n].tagname=="text"){if(n==0)h[n].start=k;if(n==h.length-1)h[n].end=l}if(n>0&&h[n-1].tagname=="text")h[n-1].end=h[n].start}},u=function(h,k,l,n){if(h!=null){var o=h.openstart,p=h.openend;if(h.tagname=="noparse"){var q="[/noparse]";p=c.substring(h.openend,l).indexOf(q);if(p>-1)p+=h.openend+10;else p=l;return{tagname:"noparse",start:h.openstart,
end:p,content:[{tagname:"text",start:h.openstart+9,end:p-10}]}}o={tagname:h.tagname,attribute:h.attribute,start:h.openstart};n=u(null,p+1,l,n+1);k=n[n.length-1].end;q="[/";q=c.substring(k,l).indexOf(q);if(q>-1)q+=k;var t=c.substring(q,l).indexOf("]");if(t>-1)t+=q;var y=c.substring(q+2,t);if(q>-1&&y==h.tagname){o.end=t+1;o.content=n}else{if(e)c.substring(k,l).indexOf("[/"+h.tagname)==-1?f.push("Open ["+h.tagname+"] tag is not properly closed (with [/"+h.tagname+"])."):f.push("Bad BBCode in ["+h.tagname+
"] tag, somewhere around/after '"+c.substr(p+1,50)+"...'.");o.tagname="text";o.end=q==-1||t==-1?l:t+1}w(n,p+1,q);o.content=n;return o}else{o=c.substring(k,l).indexOf("[");if(o>-1)o+=k;p=c.substring(o,l).indexOf("]");if(p>-1)p+=o;q=null;if(o>-1&&p>-1){h=c.substring(o+1,p).match(/^([a-z]+)(?:=([^\]]+))?/i);if(h!=null){q=h[1].toLowerCase();if(b[q]){q={tagname:q};if(h[2])q.attribute=h[2];q=q}else{e&&f.push("This looks like a bbcode tag, but isn't one: ["+q+"]");q=null}}else q=null}else return[{tagname:"text",
start:k,end:k}];if(q==null)return[{tagname:"text",start:k,end:k}];h=[];if(k<o){k=u(null,k,o,n+1);for(t=0;t<k.length;t++)h.push(k[t])}q.openstart=o;q.openend=p;o=u(q,p,l,n+1,true);h.push(o);if(o.end<l){k=u(null,o.end,l,n+1);for(t=0;t<k.length;t++)h.push(k[t])}return h}};return{Util:a,parseBB:function(h){f=[];for(var k=h.replace(/\[\]/g,"&#91;&#93;"),l=1,n=0;l!==null;){l=g.exec(k.substr(n));if(l!==null){if(l[2].indexOf("=")!=-1)l[2]=l[2].slice(0,l[2].indexOf("="));if(l[1]!="["&&l[1]!="[/"||l[3]!="]"||
!b[l[2]]){var o=l[0].replace(/\[/g,"&#91;").replace(/\]/g,"&#93;");k=k.slice(0,n+l.index)+o+k.slice(n+l.index+l[0].length);n=n+l.index+o.length}else n+=l[0].length}}c=k;d=u(null,0,c.length,0);w(d,0,c.length);k=v(d,true,true);if(k.length==0&&h.length>0){h=h;f.push("Toplevel tag structure errors found. Check your out-most tags.")}else h=k;if(e&&f.length>0){k='<div style="border: 2px solid yellow; padding: 3px; background: #600; color: white; margin-bottom: 1.5em;">Warning: The BBCode parser has found errors in your code.<ul style="margin-top: 0.5em; margin-bottom: 0.5em; padding-left: 1em; margin-left: 0.5em; list-style-type: square;">';
for(var p in f)k+="<li>"+f[p].replace(/\n/g,"")+"</li>";k+="</ul></div>";h=k+h}d=c=null;return h},parseEmotes:function(h){$.each(["hex-smile","heart","hex-yell","hex-sad","hex-grin","hex-red","hex-razz","hex-twist","hex-roll","hex-mad","hex-confuse","hex-eek","hex-wink","lif-angry","lif-blush","lif-cry","lif-evil","lif-gasp","lif-happy","lif-meh","lif-neutral","lif-ooh","lif-purr","lif-roll","lif-sad","lif-sick","lif-smile","lif-whee","lif-wink","lif-wtf","lif-yawn","cake"],function(k,l){h=h.replace(RegExp(":"+
l+":","gim"),"<img src='"+staticdomain+"images/smileys/"+l+".png' alt='"+l+" emote' title=':"+l+":' align='middle'/>")});return h},parseContent:function(h){h=this.parseBB(h);if(/<br ?\/?>/.test(h)==false)h=FList.Common_nl2br(h);return this.parseEmotes(h)},addCustomTag:function(h,k,l){b[h]={render:l,allowed:k}},addSimpleTag:function(h,k,l,n){b[h]={opentag:k,closetag:l,allowed:n}},enableWarnings:function(){e=true},addWarning:function(h){e&&f.push(h)},replaceLongWordsWith:function(h){m=true;r=h}}};
FList.Common_activateCollapsers=function(){$(".CollapseHeader[bound!=true]").each(function(){var a=this;$(a).children(".CollapseHeaderText").bind("click",function(){$(a).children(".CollapseBlock").slideToggle("fast");$(a).hasClass("ExpandedHeader")?$(a).removeClass("ExpandedHeader"):$(a).addClass("ExpandedHeader")})});$(".CollapseHeader").attr("bound","true")};
$(document).ready(function(){FList.TagParser=new FList.BBParser;FList.TagParser.addCustomTag("user",false,function(a){return/^[a-zA-Z0-9_\-\s]+$/.test(a)?'<a href="'+domain+"c/"+a+'/" target="_blank" class="AvatarLink">'+a+"</a>":a});FList.TagParser.addCustomTag("icon",false,function(a){return/^[a-zA-Z0-9_\-\s]+$/.test(a)?'<a href="'+domain+"c/"+a+'/" target="_blank"><img src="'+staticdomain+"images/avatar/"+a.toLowerCase()+'.png" style="width:50px;height:50px;" class="ParsedAvatar" align="top" /></a>':
a});FList.TagParser.addCustomTag("eicon",false,function(a){var b="gif";if(FList.animatedIcons==false)b="png";return/^[a-zA-Z0-9_\-\s]+$/.test(a)?'<img title="'+a+'" src="'+staticdomain+"images/eicon/"+a.toLowerCase()+"."+b+'" style="width:50px;height:50px;" class="ParsedAvatar" align="top"/>':a});FList.TagParser.addCustomTag("color",true,function(a,b){return/^(red|blue|white|yellow|pink|gray|green|orange|purple|black|brown|cyan)$/.test(b)?'<span class="'+b+'font">'+a+"</span>":a});FList.TagParser.addCustomTag("collapse",
true,function(a,b){return/^.+$/.test(b)?'<div class="CollapseHeader"><div class="CollapseHeaderText"><span>'+b+'</span></div><div class="CollapseBlock">'+a+"</div></div>":a});FList.TagParser.addCustomTag("img",false,function(a,b){var c,d,e;if(!/^[A-Za-z0-9]*$/.test(a)){FList.TagParser.addWarning("[img] tags contents may not contain newlines or be split across lines. You are limited to letters and numbers only.");return""}if(!/^\d+$/.test(b)){FList.TagParser.addWarning("[img] tag attributes must be only numbers.");
return""}if(typeof FList.Inlines.inlines[b]!=="object"){FList.TagParser.addWarning("Could not find an inline image with id of "+b+" and it will not be visible on your profile.");return""}e=FList.Inlines.inlines[b];c=e.hash.substr(0,2);d=e.hash.substr(2,2);return FList.inlineDisplayMode===2?'<a data-inline-id="'+b+'" class="UnloadedInline" onclick="return FList.Character_loadAllInlines()" href="#">[Inline] '+a+" </a>":FList.inlineDisplayMode===1&&e.nsfw===true?'<a data-inline-id="'+b+'" class="UnloadedInline" onclick="return FList.Character_loadAllInlines()" href="#">[NSFW Inline] '+
a+" </a>":'<div><img class="ImageBlock" src="'+staticdomain+"images/charinline/"+c+"/"+d+"/"+e.hash+"."+e.extension+'"/></div>'});FList.TagParser.addSimpleTag("quote",'blockquote><div class="QuoteHeader">Quote:</div',"blockquote",true);FList.TagParser.addSimpleTag("justify",'div class="JustifyBlock"',"div",true);FList.TagParser.addSimpleTag("left",'span class="lefttext"',"span",true);FList.TagParser.addSimpleTag("center",'span class="centertext"',"span",true);FList.TagParser.addSimpleTag("right",
'span class="righttext"',"span",true);FList.TagParser.addSimpleTag("big",'span class="bigtext"',"span",["url","i","u","b","color","s"]);FList.TagParser.addSimpleTag("small",'span class="smalltext"',"span",["url","i","u","b","color","s"]);FList.TagParser.addSimpleTag("indent",'div style="padding-left: 3em;"',"div",true);FList.TagParser.addSimpleTag("heading","h3","h3",true);FList.TagParser.parseEverything=function(a){a=a.replace(/\[hr\]/g,"<hr />");return FList.TagParser.parseContent(a)};$(".FormattedBlock").each(function(){var a=
$(this).html();if($(this).hasClass("parseURLs"))a=a.replace(/(?:[^=\]]|^)((ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?)/g,"[url]$1[/url]");$(this).html(FList.TagParser.parseEverything(a))});FList.Common_activateCollapsers()});FList.Toolbars_Init=function(){$(".SmallToolbarButton, .SmallToolbar, .TextareaToolbar").remove();var a=["lif-angry","lif-blush","lif-cry","lif-evil","lif-gasp","lif-happy","lif-meh","lif-neutral","lif-ooh","lif-purr","lif-roll","lif-sad","lif-sick","lif-smile","lif-whee","lif-wink","lif-wtf","lif-yawn"];$("textarea:not(.NoToolbar)").each(function(){$(this).before("<div class='TextareaToolbar MediumPanel'></div>");var b=this.id;$(".TextareaToolbar:last").append("<a title='Bold' class='ToolbarBold ToolbarButton' onclick=\"$('#"+
b+"').insertAtCaret('[b]','[/b]');\"></a><a title='Italic' class='ToolbarItalic ToolbarButton' onclick=\"$('#"+b+"').insertAtCaret('[i]','[/i]');\"></a><a title='Underline' class='ToolbarUnderline ToolbarButton' onclick=\"$('#"+b+"').insertAtCaret('[u]','[/u]');\"></a><a title='Justify' class='ToolbarJustify ToolbarButton' onclick=\"$('#"+b+"').insertAtCaret('[justify]','[/justify]');\"></a><a class='ToolbarQuote ToolbarButton' title='Blockquote' onclick=\"$('#"+b+"').insertAtCaret('[quote]','[/quote]');\"></a><a title='Link' class='ToolbarLink ToolbarButton' onclick=\"var linkurl=FList.Toolbars_createLink(); if(linkurl!==-1){ $('#"+
b+"').insertAtCaret('[url=' + linkurl + ']','[/url]'); }\"></a><a title='Color' class='ToolbarColor ToolbarButton' onclick=\"var colortext=FList.Toolbars_createColor(); if(colortext!==-1){ $('#"+b+"').insertAtCaret('[color=' + colortext + ']','[/color]'); }\"></a><a class='ToolbarIcon ToolbarButton' title='Icon link' onclick=\"var icontext=FList.Toolbars_createIconLink(); if(icontext!==-1){ $('#"+b+"').insertAtCaret('','[icon]' + icontext + '[/icon]'); }\"></a><a title='Collapse' class='ToolbarBlock ToolbarButton ToolbarCollapse' onclick=\"$('#"+
b+"').insertAtCaret('[collapse=title]','[/collapse]');\"></a> <a title=\"Preview\" href=\"javascript:FList.Toolbars_instantPreview('#"+b+"');\">Preview BBCode</a><div class='SmileyBox'></div>");$.each(a,function(c,d){$(".SmileyBox:last").append("<a class='ToolbarButton' onclick=\"$('#"+b+"').insertAtCaret('',':"+d+":');\"><img src='"+staticdomain+"images/smileys/"+d+".png'/></a>")})});$("#CharacterEditDescription").each(function(){var b=this.id;$(this.parentNode).find(".ToolbarCollapse").after('<a title="Insert Inline" class="ToolbarInline ToolbarButton" onclick="FList.Toolbars_showInlines(\''+
b+"')\"></a>")});$(".ToolbarTextbox").each(function(b){$(this).before("<a class='SmallToolbarButton' id='SmallToolbarButton"+b+"'></a>");var c=this.id;$(this).after("<div class='SmallToolbar MediumPanel' id='SmallToolbar"+b+"'><a class='ToolbarBold ToolbarButton' onclick=\"$('#"+c+"').insertAtCaret('[b]','[/b]');\"></a><a class='ToolbarItalic ToolbarButton' onclick=\"$('#"+c+"').insertAtCaret('[i]','[/i]');\"></a><a class='ToolbarUnderline ToolbarButton' onclick=\"$('#"+c+"').insertAtCaret('[u]','[/u]');\"></a><a class='ToolbarLink ToolbarButton' onclick=\"var linkurl=FList.Toolbars_createLink(); if(linkurl!==-1){ $('#"+
c+"').insertAtCaret('[url=' + linkurl + ']','[/url]'); }\"></a><a class='ToolbarColor ToolbarButton' onclick=\"var colortext=FList.Toolbars_createColor(); if(colortext!==-1){ $('#"+c+"').insertAtCaret('[color=' + colortext + ']','[/color]'); }\"></a><div class='SmileyBox'></div></div>");$.each(a,function(d,e){$(".SmileyBox:last").append("<a class='ToolbarButton' style='background-image:url('"+staticdomain+"images/smileys/"+e+".png');' onclick=\"$('#"+c+"').insertAtCaret('',':"+e+":');\"></a>")});
$(".SmallToolbar:last").css("width",$(this).outerWidth()+7+"px");$("#SmallToolbarButton"+b).bind("click",function(){$("#SmallToolbar"+b).slideToggle("fast")})})};FList.Toolbars_createLink=function(){var a=prompt("Please enter an url for the link, starting with 'http://'","http://");if(a!==null&&a!=="")return a;return-1};FList.Toolbars_createIconLink=function(){var a=prompt("Please enter the character's name for the icon.","");if(a!==null&&a!=="")return a;return-1};
FList.Toolbars_createColor=function(){var a=prompt("Please enter a color (available: red, blue, white, yellow, pink, gray, green, orange, purple, black, brown, cyan)","red");if(a!==null&&a!=="")return a;return-1};
FList.Toolbars_instantPreview=function(a){$("#BBCodeInstantPreview")&&$("#BBCodeInstantPreview").remove();var b=$('<div id="BBCodeInstantPreview" class="MediumPanel" style="border: 2px solid black"></div>');b.css("position","fixed");b.css("z-index","100");b.css("width","80%");b.css("top","10%");b.css("left","10%");b.css("display","hidden");$("#Content").append(b);var c=$('<img src="'+staticdomain+'images/icons/cross-circle-frame.png" alt="Close Preview" style="cursor: pointer;"/>');c.click(function(){b.fadeOut("fast").remove()});
var d=$('<div style="margin-bottom: 10px"></div>');d.css("text-align","right");d.append('<div style="float: left;"><h3 style="margin:0px;">Preview</h3></div>');d.append('<div style="float: right;"></div>').append(c);d.append('<div style="clear: both;"></div>');c=$("<div></div>").css("overflow","auto").css("padding","5px");FList.TagParser.enableWarnings();c.html(FList.TagParser.parseEverything(htmlentities($(a).val())));b.append(d);b.append(c);b.height(parseInt($(window).height()*0.8));c.height(b.height()-
d.height()-20);b.fadeIn("fast");FList.Common_activateCollapsers()};FList.Toolbars_selectInline=function(a,b){var c=FList.Inlines.inlines[b];$("#InlineImageSelector").fadeOut("fast").remove();if(c){c="[img="+b+"]"+c.name+"[/img]";$("#"+a).insertAtCaret(c,"")}};
FList.Toolbars_showInlines=function(a){$("#InlineImageSelector")&&$("#InlineImageSelector").remove();var b=$('<div id="InlineImageSelector" class="MediumPanel" style="border: 2px solid black"></div>');b.css("position","fixed");b.css("z-index","100");b.css("width","80%");b.css("top","10%");b.css("left","10%");b.css("display","hidden");$("#Content").append(b);var c=$('<img src="'+staticdomain+'images/icons/cross-circle-frame.png" alt="Close Selector" style="cursor: pointer;"/>');c.click(function(){b.fadeOut("fast").remove()});
var d=$('<div style="margin-bottom: 10px"></div>');d.css("text-align","right");d.append('<div style="float: left;"><h3 style="margin:0px;">Preview</h3></div>');d.append('<div style="float: right;"></div>').append(c);d.append('<div style="clear: both;"></div>');c=$("<div></div>").css("overflow","auto").css("padding","5px");var e=$.templates("#inlineSelectTemplate");a={inlines:function(){var f=[];$.each(FList.Inlines.inlines,function(g,m){f.push({inline_id:g,name:m.name,hash:m.hash,extension:m.extension})});
return f}(),field:a};c.html(e.render(a));b.append(d);b.append(c);b.height(parseInt($(window).height()*0.8));c.height(b.height()-d.height()-20);b.fadeIn("fast")};$(document).ready(function(){FList.Toolbars_Init()});FList.Account={isPasswordMatched:false,isUsernameValid:false,isPasswordValid:false,isEmailMatched:false,nameContains:function(a,b){for(var c=0;c<b.length;c++)if(a.indexOf(b[c])!=-1)return true;return false},comparePasswords:function(){$("#Registration_password2").css("border-right","3px solid red");FList.Account.isPasswordMatched=false;if($("#Registration_password").val()==$("#Registration_password2").val()){$("#Registration_password2").css("border-right","3px solid green");FList.Account.isPasswordMatched=
true}},compareEmails:function(){$("#Registration_email2").css("border-right","4px solid red");FList.Account.isEmailMatched=false;if($("#Registration_email").val()==$("#Registration_email2").val()){$("#Registration_email2").css("border-right","4px solid green");FList.Account.isEmailMatched=true}},calculatePasswordStrength:function(){var a=$("#Registration_password").val(),b=0,c=0,d=0,e=0;FList.Account.isPasswordValid=true;var f=$("#Registration_strengthlabel");if(FList.Account.nameContains(a,"abcdefghijklmnopqrstuvwxyz"))b=
1;if(FList.Account.nameContains(a,"0123456789"))c=1;if(FList.Account.nameContains(a,"ABCDEFGHIJKLMNOPQRSTUVWXYZ"))d=1;if(FList.Account.nameContains(a,"!@#$%^&*()_+=-{}[]|:;'\"\\/?.>,<`~"))e=1;var g=a.length/5,m=FList.Account.countCharacters(a,"0123456789"),r=FList.Account.countCharacters(a,"ABCDEFGHIJKLMNOPQRSTUVWXYZ"),s=FList.Account.countCharacters(a,"abcdefghijklmnopqrstuvwxyz");a=FList.Account.countCharacters(a,"!@#$%^&*()_+=-{}[]|:;'\"\\/?.>,<`~");g=g*(b*s+c*m*7.5+d*r*7.5+a*e*8);g=g<=100?g:100;
g=$("#Registration_username").val()==$("#Registration_password").val()||b&&!c&&!d&&!e||!b&&c&&!d&&!e||!b&&!c&&d&&!e?1:g;$("#strengthval").html(Math.round(g));$("#Registration_password").css("border-right","3px solid yellow");$("#Registration_strengthmeter").css("background","yellow");f.html("Weak");if(g>=0&&g<15){$("#Registration_strengthmeter").css("background","red");$("#Registration_password").css("border-right","3px solid red");f.html("Bad");FList.Account.isPasswordValid=false}if(g>=15&&g<35){f.html("Weak");
$("#Registration_strengthmeter").css("background","yellow");$("#Registration_password").css("border-right","3px solid yellow")}if(g>=35&&g<60){f.html("Okay");$("#Registration_strengthmeter").css("background","green");$("#Registration_password").css("border-right","3px solid green")}if(g>=60&&g<85){f.html("Strong");$("#Registration_strengthmeter").css("background","blue");$("#Registration_password").css("border-right","3px solid blue")}g>=85&&f.html("Strong++")},countCharacters:function(a,b){for(var c=
0,d=0;d<a.length;d++)for(var e=0;e<b.length;e++)if(a[d]==b[e])c+=1;return c},createAccount:function(){$("#registration_button").val("Checking username...");$("#registration_button").addClass("Busy");var a=$("#Registration_username").val();FList.Common_ajax({url:"json/checkUsername.json",data:{name:a},onSuccess:function(b){if(b.error==""){$("#Registration_username").css("border-right","4px solid green");FList.Account.isUsernameValid=false;FList.Account.compareEmails();FList.Account.comparePasswords();
FList.Account.calculatePasswordStrength();if(FList.Account.isPasswordValid)if(FList.Account.isPasswordMatched)FList.Account.isEmailMatched?$("#Registration").submit():FList.Common_displayError("The E-mails you have entered do not match.");else FList.Common_displayError("The passwords you have entered do not match.");else FList.Common_displayError("Please choose a 'weak' password at minimal.")}else FList.Common_displayError("Error, "+b.error)},onError:function(){FList.Account.isUsernameValid=false;
$("#registration_button").val("Create account")}})},validateEmail:function(a){$("#EmailValidationLink").addClass("Busy");$("#EmailValidationLink").removeClass("Error");$.ajax({type:"GET",url:domain+"/json/sendValidation.json",dataType:"json",timeout:timeoutsec*1E3,data:{a:a},success:function(b){$("#EmailValidationLink").removeClass("Busy");b.error==""?FList.Common_displayNotice("Validation e-mail sent! It should arrive within five minutes, typically instantly."):FList.Common_displayError(b.error)},
error:function(b,c,d){$("#EmailValidationLink").removeClass("Busy");$("#EmailValidationLink").addClass("Error");FList.Common_displayError("Error: "+c+", "+d)}})}};FList.Character_loadAllInlines=function(){$.each($(".UnloadedInline"),function(a,b){var c=$(b).data("inline-id");if(typeof FList.Inlines.inlines[c]==="object"){c=FList.Inlines.inlines[c];var d=c.hash.substr(0,2),e=c.hash.substr(2,2);$(b).replaceWith('<div><img class="ImageBlock" src="'+staticdomain+"images/charinline/"+d+"/"+e+"/"+c.hash+"."+c.extension+'"/></div>')}});return false};
FList.Character_displayFriends=function(){var a=$("#profile-character-id").val();$(".fthumbbox").addClass("BusyTab");$.ajax({type:"POST",url:domain+"json/profile-friends.json",dataType:"json",timeout:timeoutsec*1E3,data:{character_id:a},success:function(b){$(".fthumbbox").removeClass("BusyTab");if(b.error==""){$(".fthumbbox").html("");$.each(b.friends,function(c,d){var e=staticdomain+"images/avatar/"+d.toLowerCase()+".png";$(".fthumbbox").append('<a href="'+domain+"c/"+d.toLowerCase()+'"><img src="'+
e+'" class="avatarthumbnail" /></a>')})}else FList.Common_displayError(b.error)},error:function(b,c,d){$(".fthumbbox").removeClass("BusyTab");FList.Common_displayError(c+", "+d)}})};
FList.Character_displayImages=function(){var a=$("#profile-character-id").val();$(".thumbbox").addClass("BusyTab");$.ajax({type:"POST",url:domain+"json/profile-images.json",dataType:"json",timeout:timeoutsec*1E3,data:{character_id:a},success:function(b){$(".thumbbox").removeClass("BusyTab");if(b.error==""){$(".thumbbox").html("");$.each(b.images,function(c,d){var e=staticdomain+"images/charthumb/"+d.image_id+"."+d.extension,f=staticdomain+"images/charimage/"+d.image_id+"."+d.extension,g=parseInt(d.width),
m=parseInt(d.height),r=Math.abs(g/m);if(g>m){g=100;m=Math.round(100/r)}else if(g==m)g=m=100;else{r=m/g;m=100;g=Math.round(100/r)}r=Math.round((100-m)/2+10);$(".thumbbox").append('<a href="'+f+'" target="_blank"><img src="'+e+'" title="'+d.description+'" style="width:'+g+"px;height:"+m+"px;margin-top:"+r+"px;margin-bottom:"+r+'px;" class="thumbnail" /></a>')})}else FList.Common_displayError(b.error)},error:function(b,c,d){$(".thumbbox").removeClass("BusyTab");FList.Common_displayError(c+", "+d)}})};
FList.Character_displayGroups=function(){var a=$("#profile-character-id").val();$(".groupthumbs").addClass("BusyTab");$.ajax({type:"POST",url:domain+"json/profile-groups.json",dataType:"json",timeout:timeoutsec*1E3,data:{character_id:a},success:function(b){$(".groupthumbs").removeClass("BusyTab");if(b.error==""){$(".groupthumbs").html("");$.each(b.groups,function(c,d){$(".groupthumbs").append("<a href='"+domain+"group.php?group="+d.toLowerCase()+"'><img src='"+staticdomain+"images/groupavatar/"+d.toLowerCase()+
".png'/><br/>"+d+"</a>")})}else FList.Common_displayError(b.error)},error:function(b,c,d){$(".groupthumbs").removeClass("BusyTab");FList.Common_displayError(c+", "+d)}})};FList.Character={};FList.Character.guestbookPage=0;FList.Character.guestbookUnapprovedOnly=false;FList.Character_guestbookChangedUnapproved=function(){FList.Character.guestbookUnapprovedOnly=$("#guestbook-unapproved-only").prop("checked");FList.Character_displayGuestbook()};
FList.Character_displayGuestbook=function(a,b){var c=$("#profile-character-id").val();a=typeof a!=="undefined"?a:FList.Character.guestbookPage;b=typeof b!=="undefined"?b:FList.Character.guestbookUnapprovedOnly;$("#charguestbookposts").addClass("BusyTab");$.ajax({type:"POST",url:domain+"json/profile-guestbook.json",dataType:"json",timeout:timeoutsec*1E3,data:{character_id:c,page:a,unapproved_only:b,csrf_token:FList.csrf_token()},success:function(d){$("#charguestbookposts").removeClass("BusyTab");if(d.error==
""){var e=$.templates("#guestbookTemplate");d.page=a;d.domain=domain;d.staticdomain=staticdomain;$.each(d.posts,function(f,g){g.friendlyname=g.character.toLowerCase()});$("#charguestbookposts").html(e.render(d));$(".GuestbookContents, .GuestbookReply").each(function(){var f=$(this).html();$(this).html(FList.TagParser.parseEverything(f))});FList.Common_activateCollapsers()}else FList.Common_displayError(d.error)},error:function(d,e,f){$("#charguestbookposts").removeClass("BusyTab");FList.Common_displayError(e+
", "+f)}})};
FList.Character_guestbookPost=function(a,b){$.ajax({type:"POST",url:domain+"json/guestbook-post.json",dataType:"json",timeout:timeoutsec*1E3,data:{character_id:b,source_character_id:a.form.character_id.value,"private":a.form.privatepost.checked,message:a.form.message.value,csrf_token:FList.csrf_token()},success:function(c){if(c.error===""){FList.Character_displayGuestbook();a.form.message.value=""}else FList.Common_displayError("Error while posting your guestbook post: "+c.error)},error:function(c,d,
e){FList.Common_displayError("Error while posting your guestbook post: "+d+":"+e)}});return false};
FList.Character_guestbookReply=function(a){$(".replybox").remove();$("<div class='replybox replybox"+a+"'><a class='close' onclick=\"$('.replybox"+a+"').slideUp('fast',function(){$(this).remove();});\"></a><textarea></textarea><input type='button' class='post' value='Post Reply'/></div>").insertAfter("#Character_GuestbookPost"+a).hide().slideDown("fast");$("#comment_reply_active").val($("#def").val());$(".replybox"+a+" input").click(function(){$(this).val("Posting...").attr("disabled",true);var b=
$(".replybox"+a+" textarea").val();FList.Character_guestbookReplyPost(a,b)})};
FList.Character_guestbookReplyPost=function(a,b){$.ajax({type:"POST",url:domain+"json/guestbook-reply.json",dataType:"json",timeout:timeoutsec*1E3,data:{post_id:a,reply:b,csrf_token:FList.csrf_token()},success:function(c){c.error==""?FList.Character_displayGuestbook():FList.Common_displayError("Posting reply failed on server; "+c.error)},error:function(c,d,e){a!==0&&$(".replybox"+a+" input").attr("disabled",false).val("Post Reply");FList.Common_displayError("Posting comment failed; "+d+":"+e)}})};
FList.Character_guestbookApprove=function(a,b){$.ajax({type:"POST",url:domain+"json/guestbook-approve.json",dataType:"json",timeout:timeoutsec*1E3,data:{post_id:a,approved:b,csrf_token:FList.csrf_token()},success:function(c){c.error==""?FList.Character_displayGuestbook():FList.Common_displayError(c.error)},error:function(c,d,e){FList.Common_displayError(d+", "+e)}})};
FList.Character_deleteGuestbook=function(a){confirm("Are you sure you want to delete this post?")&&$.ajax({type:"POST",url:domain+"json/guestbook-delete.json",dataType:"json",timeout:timeoutsec*1E3,data:{post_id:a,csrf_token:FList.csrf_token()},success:function(b){b.error==""?$("#Character_GuestbookPost"+a).hide("fast",function(){$(this).remove();$(".Character_GuestbookPost").removeClass("EvenRowItem");$(".Character_GuestbookPost:even").addClass("EvenRowItem")}):FList.Common_displayError(b.error)},
error:function(b,c,d){FList.Common_displayError(c+", "+d)}})};FList.Character_processTooltips=function(){$("a.Character_CustomFetish, a.Character_ListedFetish").each(function(){var a=$(this).attr("rel")==""?"No description set yet.":htmlentities($(this).attr("rel"));$(this).qtip({show:{when:"mouseover",solo:true},hide:{when:"mouseout",fixed:false},position:{my:"top center",at:"bottom center"},style:{classes:"ui-tooltip-shadow",widget:true},content:{text:a,title:htmlentities($(this).text())}})})};
FList.Character_quickCompare=function(a){$("a.Character_ListedFetish").removeClass("Character_QuickCompareFave Character_QuickCompareYes Character_QuickCompareMaybe Character_QuickCompareNo Character_QuickCompareActive");if(a)return true;$("#Character_QuickCompareButton").attr("disabled","true");$("#Character_QuickCompareButton").html('<span class="Busy" style="height:18px;padding-left: 20px">Working...</span>');var b={fave:"Character_QuickCompareFave",yes:"Character_QuickCompareYes",maybe:"Character_QuickCompareMaybe",
no:"Character_QuickCompareNo"};$.getJSON(domain+"json/getFetishes.php",{character_id:$("#Character_QuickCompareSelect").val(),id_only:true},function(c){if(c.error===""&&c.fetishes!==undefined){$.each(c.fetishes,function(d,e){$("#Character_ListedFetish"+e.fid).addClass("Character_QuickCompareActive").addClass(b[e.choice])});$("#Character_QuickCompareButton").html("Compare!")}else $("#FetishImportButton").html("Error!");$("#Character_QuickCompareButton").prop("disabled","")});return false};
FList.Character_highlightGroup=function(a){$(".Character_ListedFetish").removeClass("Character_HighlightedFetish");$(".Character_FetishGroup"+a).addClass("Character_HighlightedFetish")};
FList.Character_deleteCharacter=function(a,b){var c=prompt("Character deletion is permanent.\nType the character name to confirm deletion.");if(c!==null)if(c.toLowerCase()===b.toLowerCase()){$("#Characterlist_Character"+a+"  .delete").addClass("Busy");$.ajax({type:"POST",url:domain+"json/deleteCharacter.json",dataType:"json",timeout:timeoutsec*5E3,data:{id:a,csrf_token:FList.csrf_token()},success:function(d){$("#Characterlist_Character"+a+"  .delete").removeClass("Busy");if(d.error==""){$("#Characterlist_Character"+
a).hide("fast",function(){$(this).remove()});document.location.href=domain}else FList.Common_displayError(d.error)},error:function(d,e,f){FList.Common_displayError(e+", "+f)}})}else alert("Character name did not match. Your Character was not deleted.")};
FList.Character_adminDeleteCharacter=function(a){if(confirm("Are you sure you want to permanently delete this character?")){$("#Characterlist_Character"+a+"  .delete").addClass("Busy");$.ajax({type:"POST",url:domain+"json/deleteCharacter.json",dataType:"json",timeout:timeoutsec*5E3,data:{id:a,admin:"1",csrf_token:FList.csrf_token()},success:function(b){$("#Characterlist_Character"+a+"  .delete").removeClass("Busy");if(b.error==""){$("#Characterlist_Character"+a).hide("fast",function(){$(this).remove()});
document.location.href=domain}else FList.Common_displayError(b.error)},error:function(b,c,d){FList.Common_displayError(c+", "+d)}})}};
FList.Character_track=function(a){$("#Character_PageAdd").addClass("Busy");$("#Character_PageAdd").html("Working...");$.ajax({type:"POST",url:domain+"json/userTrack.json",dataType:"json",timeout:timeoutsec*1E3,data:{dest_character_id:a,csrf_token:FList.csrf_token()},success:function(b){$("#Character_PageAdd").removeClass("Busy");if(b.error==""){$("#Character_PageAdd").html("Bookmark");if(b.state=="yes"){$("#Character_PageAdd").removeClass("bookmarkadd");$("#Character_PageAdd").addClass("bookmarkdel");
b.count>=2E3&&FList.Common_displayNotice("<div style='text-align: center;'>Bookmark added, but here be dragons: You've already bookmarked "+b.count+" characters.<br><u>The official chat clients for F-Chat may no longer work!</u><br>This is a known issue, and it cannot be fixed. Consider deleting some of your bookmarks.</div>")}if(b.state=="no"){$("#Character_PageAdd").removeClass("bookmarkdel");$("#Character_PageAdd").addClass("bookmarkadd")}}else FList.Common_displayError(b.error)},error:function(b,
c,d){FList.Common_displayError(c+", "+d)}})};
FList.CharEditor_instantPreview=function(){$("#ProfileInstantPreview")&&$("#ProfileInstantPreview").remove();var a=$('<div id="ProfileInstantPreview" class="MediumPanel" style="border: 2px solid black"></div>');a.css("position","absolute");a.css("z-index","100");a.css("width","80%");a.css("top","10%");a.css("left","10%");a.css("display","hidden");$("#Content").append(a);var b=$('<img src="'+staticdomain+'images/icons/cross-circle-frame.png" alt="Close Preview" style="cursor: pointer;"/>');b.click(function(){a.fadeOut("fast").remove()});
var c=$('<div style="margin-bottom: 10px"></div>');c.css("text-align","right");c.append('<div style="float: left;"><h3 style="margin:0px;">Description Instant Preview</h3></div>');c.append('<div style="float: right;"></div>').append(b);c.append('<div style="clear: both;"></div>');b=$("<div></div>").css("overflow","auto").css("padding","5px");FList.TagParser.enableWarnings();b.html(FList.TagParser.parseEverything(htmlentities($("#CharacterEditDescription").val())));a.append(c);a.append(b);a.height(parseInt($(window).height()*
0.8));b.height(a.height()-c.height()-20);a.fadeIn("fast");FList.Common_activateCollapsers()};
FList.CharEditor_addImage=function(){$(".UploadedCharacterImage").length==0&&$("#CharacterImageList").html("");if(FList.isSubscribed){if($(".UploadedCharacterImage").length>=150){FList.Common_displayError("150 images is the maximum.");return}}else if($(".UploadedCharacterImage").length>=50){FList.Common_displayError("50 images is the maximum.");return}var a=getFreeID("UploadedCharacterImage"),b=$("<div class='UploadedCharacterImage panel form-element' id='UploadedCharacterImage"+a+"'><div onclick=\"$('#UploadedCharacterImage"+
a+"').remove();\" class='del list-item-important'><a></a></div><span class='simple-label-small'>"+a+"</span><input class='file' type='file' name='image_"+a+"'/><span class='simple-label-small'>Description</span><input type='text' class='Textbox' name='imagedescription_"+a+"'/> </div>");insertOrdered(a,b,"UploadedCharacterImage","CharacterImageList")};function getFreeID(a){for(var b=1,c=1;c<=500;c++)if(!($("#"+a+c).length>0)){b=c;break}return b}
FList.CharEditor_toggleFetishHeader=function(a,b){if($("#FetishGroup"+a+":visible").length==0||typeof b!=="undefined"){$("#FetishGroup"+a).slideDown();$("#FetishBoxHeader"+a).removeClass("GroupHidden");$("#FetishBoxHeader"+a).addClass("GroupShown")}else{$("#FetishGroup"+a).slideUp();$("#FetishBoxHeader"+a).addClass("GroupHidden");$("#FetishBoxHeader"+a).removeClass("GroupShown")}};
FList.CharEditor_toggleAllHeaders=function(){$(".FetishGroupShow").prop("checked","checked");$(".FetishBox").show();$(".FetishBoxHeader").removeClass("GroupHidden");$(".FetishBoxHeader").removeClass("GroupShown");$(".FetishBoxHeader").addClass("GroupShown");$(".FetishBoxHeader").css("display","block")};
FList.CharEditor_toggleInfotags=function(a,b){if($("#InfotagGroup"+a+":visible").length==0||typeof b!=="undefined"){$("#InfotagGroup"+a).slideDown();$("#InfotagGroupHeader"+a).removeClass("GroupHidden");$("#InfotagGroupHeader"+a).addClass("GroupShown")}else{$("#InfotagGroup"+a).slideUp();$("#InfotagGroupHeader"+a).addClass("GroupHidden");$("#InfotagGroupHeader"+a).removeClass("GroupShown")}};
FList.CharEditor_addKink=function(){if(FList.CharEditor_kinkCount==0){var a=$("#CustomKinksList .CustomKink").size();if(a>0)FList.CharEditor_kinkCount=a;else $("#CustomKinksList").html("")}if($("#CustomKinksList .CustomKink").length>=500)FList.Common_displayError("500 custom kinks is the maximum.");else{a=getFreeID("CustomKink");var b="CustomKink"+a,c=$("#CustomKink_TEMPLATE_").clone();c.attr("id",b);insertOrdered(a,c,"CustomKink","CustomKinksList");c=$("#"+b).html();c=c.replace(/_TEMPLATE_/g,a);
c=c.replace(/_CUSTOMID_/g,a);$("#"+b).html(c);$("#"+b).show()}};function insertOrdered(a,b,c,d){var e=$("#"+d+" ."+c+":last");e=e.length>0?e.attr("id").substring(c.length):0;if(a>e||$("#"+d+" ."+c).length==0)$("#"+d).append(b);else{a=0;for(var f=false,g=1;g<=e;g+=1)if($("#"+c+g).length==0)a=g;else if(a!==0){b.insertBefore($("#"+c+g));f=true;break}f||b.insertAfter($("#"+d+" ."+c+":last"))}}
FList.CharEditor_submitCharacter=function(){var a=$("#VarCharacterName").val();$("#CharacterCreateStatus").html("Checking username...");$("#CharacterCreateStatus").addClass("CharacterCreateStatusBusy");$.ajax({type:"GET",url:domain+"json/checkCharacterName.json",dataType:"json",timeout:timeoutsec*1E3,data:{name:a},success:function(b){if(b.error==""){FList.CharEditor_CharEditor_validCharacter=true;$("#CharacterCreateStatus").html("Done! Submitting character...");$("#CharacterForm").submit();return true}else{FList.CharEditor_CharEditor_validCharacter=
false;$("#CharacterCreateStatus").html("Failed.");$("#CharacterCreateStatus").removeClass("CharacterCreateStatusBusy");FList.Common_displayError("The name you picked is not valid: "+b.error);return false}},error:function(b,c,d){FList.CharEditor_CharEditor_validCharacter=false;$("#CharacterCreateStatus").html("Failed.");$("#CharacterCreateStatus").removeClass("CharacterCreateStatusBusy");FList.Common_displayError("An error occured, character name check was not completed; please try again. "+c+":"+
d);return false}})};FList.CharEditor_resetKinks=function(){confirm("Are you sure you want to set all kinks to undecided?")&&$(".Fetish").each(function(a,b){var c=$(b).attr("id").substring(12);$(b).val("undecided");$(".FetishLink"+c).removeClass("FetishChoicePicked").addClass("FetishChoiceNotPicked");$(".FetishImage"+c).removeClass("FetishImagePicked").addClass("FetishImageNotPicked")})};
FList.CharEditor_selectFetish=function(a,b,c){if((typeof c!="undefined"?null:$("#FetishSelect"+a).val())!==b){$(".FetishLink"+a).addClass("FetishChoiceNotPicked");$(".FetishImage"+a).addClass("FetishImageNotPicked");$(".FetishLink"+a).removeClass("FetishChoicePicked");$("#FetishLink"+b+a).addClass("FetishChoicePicked");$("#FetishLink"+b+a).removeClass("FetishChoiceNotPicked");$("#FetishImage"+b+a).removeClass("FetishImageNotPicked");$("#FetishSelect"+a).val(b)}else{$("#FetishSelect"+a).val("undecided");
$(".FetishLink"+a).removeClass("FetishChoicePicked");$(".FetishImage"+a).removeClass("FetishImagePicked");$(".FetishLink"+a).addClass("FetishChoiceNotPicked");$(".FetishImage"+a).addClass("FetishImageNotPicked")}};FList.CharEditor_initEditor=function(){FList.CharEditor_imageCount=0;FList.CharEditor_kinkCount=0;FList.CharEditor_validCharacter=false;$(".FetishGroupShow").prop("checked",true)};
function openCustomMenu(a){var b=$(a).text(),c=$(a).attr("rel");$(a).contextMenu({outSpeed:"fast",inSpeed:"fast",menu:"CustomMenu",beforeOpen:function(){},callback:function(d){if(d=="add"){if(typeof FList.kinkStealdlg!=="undefined"){FList.kinkStealdlg.dialog("destroy");FList.kinkStealdlg.html("")}FList.kinkStealdlg=$('<div class="StyledForm" id="customform"><h3>Add Custom Kink to your character</h3><p><span class="label">Add to:</span><span class="element"><select class="select customselectchar"></select></span></p><p><span class="label">As:</span><span class="element"><select class="select customselectchoice"><option selected="selected" value="fave">Fave</option><option value="yes">Yes</option><option value="no">No</option><option value="maybe">Maybe</option></select></span></p><p><span class="label">Name:</span><span class="element"><input class="customselectname" type="text"/></span></p><p><span class="label">Description:</span><span class="element"><textarea class="customselectdescription"></textarea></span></p></div>');
FList.kinkStealdlg.dialog({autoOpen:true,height:400,width:400,modal:true,title:"Add Custom Kink",buttons:[{text:"Cancel",id:"dialog-steal-cancel",click:function(){FList.kinkStealdlg.dialog("close")}},{text:"Add",id:"dialog-steal-add",click:function(){var e=$(".customselectchar").val(),f=$(".customselectname").val(),g=$(".customselectdescription").val(),m=$(".customselectchoice").val(),r=$(a).attr("id").substring(22);$("#dialog-steal-add").button("option","label","Adding...");$("#dialog-steal-add, #dialog-steal-cancel").button("disable");
FList.Common_ajax({url:"json/addCustomKink.json",type:"POST",data:{character_id:e,name:f,description:g,choice:m,fetish_id:r},onSuccess:function(){FList.Common_displayNotice("Custom kink was added to your character.");FList.kinkStealdlg.dialog("close")},onEither:function(){$("#dialog-steal-add, #dialog-steal-cancel").button("enable");$("#dialog-steal-add").button("option","label","Add")},onError:function(){FList.Common_displayError(data.error)}})}}],open:function(){$(".customselectchar").html($("#CharacterData").html());
$(".customselectname").val(jQuery.trim(b));$(".customselectdescription").val(c)}})}}})}
FList.Character_initProfile=function(){var a=$("#profile-character-name").val().toLowerCase(),b=$("#profile-character-name").val(),c=$("#profile-character-id").val()+"",d=$("#profile-verified").val(),e=$("#profile-editblock").val(),f=$("#profile-public").val(),g=[{text:"Staff actions",type:"menu-header"},{text:"Staff Notes",type:"menu-link",path:"panel/adminnote.php?character="+a}];if(FList.Rights.has("moderation-site")||FList.Rights.has("admin")||FList.Rights.has("chat-chatop")||FList.Rights.has("helpdesk-general")){g.push({text:"Moderator Tool",
type:"menu-link",path:"panel/lookup.php?character="+a});g.push({text:"Manage Images",type:"menu-link",path:"panel/images.php?character="+c});e!=1?g.push({text:"Block Until Edited",type:"menu-action",handler:function(){FList.Character_blockUntilEdited(c,b)}}):g.push({text:"Un-Block Until Edited",type:"menu-action",handler:function(){FList.Character_unblockUntilEdited(c)}});d!=1?g.push({text:"Verify",type:"menu-action",handler:function(){FList.Character_verifyOwnership(c,true)}}):g.push({text:"Unverify",
type:"menu-action",handler:function(){FList.Character_verifyOwnership(c,false)}});g.push({text:f==1?"Mark as private":"Mark as public",type:"menu-action",handler:function(){FList.Character_forcePrivate(c,f==1)}});g.push({text:"Deleted w/Name",type:"menu-link",path:"/panel/deletedchars.php?name="+a})}if(FList.Rights.has("moderation-site")||FList.Rights.has("admin")||FList.Rights.has("helpdesk-general")){g.push({text:"Fix Friend Requests",type:"menu-link",path:"panel/fixfriendcounter.php?character="+
a});g.push({text:"Alts",type:"menu-link",path:"panel/alts.php?character="+c})}FList.Rights.has("admin")&&g.push({text:"Delete character",type:"menu-action",handler:function(){FList.Character_adminDeleteCharacter(c)}});$(".moderation-button").FlexMenu({items:g});$("#tabs").tabs();$("#CharacterId").val();FList.Character_processTooltips();$(".sociallink[title]").qtip({position:{my:"top center",at:"bottom center"},style:{classes:"ui-tooltip-shadow",widget:true}});$(".thumbbox img").each(function(){var m=
strip_tags($(this).attr("rel"));$(this).qtip({content:{title:"Image description",text:m},position:{my:"top center",at:"bottom center"},style:{classes:"ui-tooltip-shadow",widget:true}})});$("<ul/>").attr("id","CustomMenu").addClass("contextMenu").appendTo(document.body);$("#CustomMenu").append('<li class="add"><a href="#add">Add this</a></li>');$(document).bind("mouseup.fetishclick",function(m){m.which==3&&$(m.target).hasClass("Character_CustomFetish")&&openCustomMenu(m.target)});$(".friendbutton").click(function(){$('<div class="StyledForm" id="friendform"><h3>Friends with '+
b+' as:</h3><div id="frienddata">Loading friend data...</div><h3>Send Friend Request</h3>This person will have to accept your friend request before they are added to your friends list.<br/><br/><p><span class="label">Send as:</span><span class="element"><select class="select friendselectchar"></select></span></p><br/><input type="button" onclick="sendFriendRequest();" value="Send Invite"/></div>').dialog({autoOpen:true,height:400,width:400,modal:true,title:"Manage friends list",buttons:{Close:function(){$(this).dialog("close").remove()}},
open:function(){$(".friendselectchar").html($("#CharacterData").html());$("#frienddata").html("Loading friend data...");$.ajax({type:"POST",url:domain+"json/getFriends.json",dataType:"json",timeout:timeoutsec*1E3,data:{character_id:c},success:function(m){if(m.error==""){$("#frienddata").html("");$.each(m.friends,function(r,s){$("#frienddata").append("<div class='defriend"+s.source_character_id+"_"+c+"'><a class='defriend' onclick=\"FList.Friends_defriend('"+s.source_character_id+"', '"+c+"')\">Remove</a>"+
s.source_name+"</div>")});$.each(m.pending,function(r,s){$("#frienddata").append("<div class='pending cancelpending"+s.request_id+"'><a class='friendcancel' onclick=\"FList.Friends_cancelPending('"+s.request_id+"', '"+c+"')\">Cancel</a><i>Pending</i> - "+s.source_name+"</div>")});m.friends.length==0&&m.pending.length==0&&$("#frienddata").append("None of your characters are friends with "+b+".")}else FList.Common_displayError(m.error)},error:function(m,r,s){FList.Common_displayError(r+", "+s)}})}})})};
function sendFriendRequest(){var a=$("#profile-character-id").val();$.ajax({type:"POST",url:domain+"json/friendRequest.json",dataType:"json",timeout:timeoutsec*1E3,data:{source_character_id:$(".friendselectchar").val(),dest_character_id:a,csrf_token:FList.csrf_token()},success:function(b){if(b.error==""){$(".friendbutton").text("Edit");FList.Common_displayNotice("Friend request has been sent.");$("#friendform").dialog("close").remove()}else FList.Common_displayError(b.error)},error:function(b,c,d){FList.Common_displayError(c+
", "+d)}})};FList.News_postRootComment=function(a,b,c){$("#post-root-comment").val("Posting...").attr("disabled",true);FList.Common_postComment(a,b,c,0,"newspost",function(d){$("#post-root-comment").attr("disabled",false).val("Submit comment");d&&$("#VarNewspostMessage").val("")})};FList.Poll_init=function(){FList.Poll_topVotes=0;FList.Poll_answerCount=0;$(".PollAnswer span.PollVotes").each(function(a,b){var c=parseInt($(b).html(),10);if(c>FList.Poll_topVotes)FList.Poll_topVotes=c});FList.Poll_drawBars();if(!$("#PollVoted").val()){$(".PollAnswer").each(function(a,b){var c=b.id.substring(10);$(b).bind("click",function(){FList.Poll_addVote(c)})});$(".PollAnswer").addClass("ActivePollAnswer")}};
FList.Poll_addVote=function(a){$("#PollAnswer"+a).addClass("Busy");$.ajax({type:"GET",url:domain+"json/addPollVote.json",dataType:"json",timeout:timeoutsec*1E3,data:{answer_id:a},success:function(b){$("#PollAnswer"+a).removeClass("Busy");$(".PollAnswer").removeClass("ActivePollAnswer");if(b.error==""){$("#PollAnswer"+a+" span.VoteStatus").addClass("PollVoted");$("#PollAnswer"+a+" span.VoteStatus").html("Voted");$("#PollAnswer"+a+" span.PollVotes").html(b.votes);if(b.votes>FList.Poll_topVotes)FList.Poll_topVotes=
b.votes;FList.Poll_drawBars()}else{$("#PollAnswer"+a+" span.VoteStatus").html(b.error);$("#PollAnswer"+a+" span.VoteStatus").addClass("PollVoteFailed")}},error:function(b,c,d){FList.Common_displayError("Onlninelist update failed; try refreshing the page. Error:"+d);$("#PollAnswer"+a).removeClass("Busy");$("#PollAnswer"+a+" span.VoteStatus").addClass("PollVoteFailed");$("#PollAnswer"+a+" span.VoteStatus").html("Failed, retry")}})};
FList.Poll_drawBars=function(){$(".PollAnswer").each(function(a,b){var c=b.id.substring(10),d=$("#PollAnswer"+c+" span.PollVotes").html();d=Math.round(100/FList.Poll_topVotes*d);$("#PollPercentage"+c).css("width",d+"%")})};FList.Poll_remove=function(){$("#AddPollBox").hide("slow");$("#AddPollLink").show("fast");$("#SubmitPoll").val("0")};FList.Poll_add=function(){$("#AddPollBox").show("slow");$("#AddPollLink").hide("fast");$("#SubmitPoll").val("1")};
FList.Poll_addQuestion=function(){if(FList.Poll_answerCount<8){FList.Poll_answerCount++;$("#PollAnswersBox").append("<div class='PollEditAnswer'><input type='text' name='pollanswer[]' class='Textbox'/> Icon: <select name='pollicon[]'><option selected='selected' value=''>None</option><option>Up</option><option>Down</option><option>Star</option><option>Heart</option></select></div>")}else FList.Common_displayError("8 answers is the maximum.")};
FList.Poll_removeQuestion=function(){if(FList.Poll_answerCount>0){FList.Poll_answerCount--;$(".PollEditAnswer:last").remove()}};FList.Manager_initGroupManager=function(){$(".GroupForum:even").addClass("EvenRowItem");$(".EditableGroupMember:even").addClass("EvenRowItem");$(".EditableGroupForum:even").addClass("EvenRowItem")};
FList.Manager_setGroupDescription=function(a){var b=$("#GroupDescription").val();$.ajax({type:"POST",url:domain+"json/setGroupDescription.json",dataType:"json",timeout:timeoutsec*1E3,data:{group_id:a,description:b,csrf_token:FList.csrf_token()},success:function(c){c.error==""?FList.Common_displayNotice("Done! Your group description was successfully saved."):FList.Common_displayError(c.error)},error:function(c,d,e){FList.Common_displayError("Failed. Error:"+e)}})};
FList.Manager_setGroupKeywords=function(a){var b=$("#GroupKeywords").val();$.ajax({type:"POST",url:domain+"json/setGroupKeywords.json",dataType:"json",timeout:timeoutsec*1E3,data:{group_id:a,keywords:b,csrf_token:FList.csrf_token()},success:function(c){c.error==""?FList.Common_displayNotice("Done! Your group keywords were successfully saved."):FList.Common_displayError(c.error)},error:function(c,d,e){FList.Common_displayError("Failed. Error:"+e)}})};
FList.Manager_setGroupOwner=function(a){var b=$("#GroupOwnerCharacter").val();$.ajax({type:"POST",url:domain+"json/setGroupOwner.json",dataType:"json",timeout:timeoutsec*1E3,data:{group_id:a,character_id:b,csrf_token:FList.csrf_token()},success:function(c){c.error==""?FList.Common_displayNotice("Done! Your group owner character was successfully modified."):FList.Common_displayError(c.error)},error:function(c,d,e){FList.Common_displayError("Failed. Error:"+e)}})};
FList.Manager_groupBan=function(){if(confirm("Are you sure you want to ban this user?")){var a=$("#BanName").val(),b=$("#BanReason").val(),c=$("#BanGroup").val();$("#BanReason").val("");$("#BanName").val("");$.ajax({type:"POST",url:domain+"json/banFromGroup.json",dataType:"json",timeout:timeoutsec*1E3,data:{name:a,reason:b,group_id:c,csrf_token:FList.csrf_token()},success:function(d){if(d.error==""){FList.Common_displayNotice("User has been banned. ");$("#BanList").append("<div class='EditableGroupMember ResultListing' id='EditableGroupMember"+
d.banned_character_id+"'><a class='EditableGroupMemberDelete ImageLink' onclick=\"FList.Manager_groupUnban('"+d.banned_character_id+"');\">Unban</a>"+d.banned_character+" &bull; reason: "+d.reason+"</div>")}else FList.Common_displayError(d.error)},error:function(d,e,f){FList.Common_displayError("Failed. Error:"+f)}})}};
FList.Manager_groupUnban=function(a){if(confirm("Are you sure you want to unban this user?")){var b=$("#BanGroup").val();$.ajax({type:"POST",url:domain+"json/unbanFromGroup.json",dataType:"json",timeout:timeoutsec*1E3,data:{character_id:a,group_id:b,csrf_token:FList.csrf_token()},success:function(c){if(c.error==""){FList.Common_displayNotice("User has been unbanned.");$("#EditableGroupMember"+a).slideUp("fast",function(){$(this).remove()})}else FList.Common_displayError(c.error)},error:function(c,
d,e){FList.Common_displayError("Failed. Error:"+e)}})}};FList.Groups_filterBrowse=function(){var a=parseInt($("#GroupPostFilter").val());$(".ListedGroup").hide();$(".ListedGroup").each(function(){parseInt($(this).attr("rel"))>a&&$(this).show()});$(".ListedGroup:first").show();a==0&&$(".ListedGroup").show();$("#FilterHeader").html("Other groups ("+a+"+ posts)")};FList.Group_getJoinPanel=function(){return"<select id='joindd'>"+$("#NotJoinedUsersList").html()+"</select>"};
FList.Group_getLeavePanel=function(){return"<select id='leavedd'>"+$("#JoinedUsersList").html()+"</select>"};
FList.Group_join=function(a){var b=$("#joindd").val();b==""?FList.Common_displayError("No character selected."):$.ajax({type:"POST",url:domain+"json/joinGroup.json",dataType:"json",timeout:timeoutsec*1E3,data:{group_id:a,character_id:b,csrf_token:FList.csrf_token()},success:function(c){if(c.error==""){$("#NotJoinedUsersList option[value="+b+"]").remove();$("#JoinedUsersList").append($("#UsersList option[value="+b+"]"));FList.Common_displayNotice("Group successfully joined.")}else FList.Common_displayError(c.error)},
error:function(c,d,e){FList.Common_displayError("Join failed; try again. Error:"+e)}})};
FList.Group_leave=function(a){s_group_id=a;s_character_id=$("#leavedd").val();s_character_id==""?FList.Common_displayError("No character selected."):$.ajax({type:"POST",url:domain+"json/leaveGroup.json",dataType:"json",timeout:timeoutsec*1E3,data:{group_id:s_group_id,character_id:s_character_id,csrf_token:FList.csrf_token()},success:function(){$("#JoinedUsersList option[value="+s_character_id+"]").remove();$("#NotJoinedUsersList").append($("#UsersList option[value="+s_character_id+"]"));FList.Common_displayNotice("Group successfully left.")},
error:function(b,c,d){FList.Common_displayError("Leave failed; try again. Error:"+d)}})};
FList.Group_initJoinLeave=function(){var a=$("<div></div>");a.dialog({autoOpen:false,title:"Join group with...",width:"400",modal:true,buttons:{Join:function(){var c=$("#VarGroupId").val();FList.Group_join(c);a.dialog("close")},Cancel:function(){a.dialog("close")}}});$("#GroupJoinLink").click(function(){a.dialog("open");a.html(FList.Group_getJoinPanel());$("#joindd option:nth-child(2)").attr("selected",true)});var b=$("<div></div>");b.dialog({autoOpen:false,title:"Leave group with...",width:"400",
modal:true,buttons:{Leave:function(){var c=$("#VarGroupId").val();FList.Group_leave(c);b.dialog("close")},Cancel:function(){b.dialog("close")}}});$("#GroupLeaveLink").click(function(){b.dialog("open");b.html(FList.Group_getLeavePanel());$("#leavedd option:nth-child(2)").attr("selected",true)})};FList.Ticket_removeReply=function(a){confirm("Are you sure you want to delete this ticket reply?")&&$.ajax({type:"POST",url:domain+"json/deleteTicketReply.json",dataType:"json",timeout:timeoutsec*1E3,data:{update_id:a},success:function(b){b.error==""?$("#TicketUpdate"+a).hide("fast",function(){$(this).remove()}):FList.Common_displayError(b.error)},error:function(b,c,d){FList.Common_displayError("Error: "+c+", "+d)}})};
FList.Ticket_close=function(a){confirm("Are you sure you want to close this ticket? (Have all the issues in the ticket been resolved?)")&&$.ajax({type:"GET",url:domain+"json/removeTicket.json",dataType:"json",timeout:timeoutsec*1E3,data:{ticket_id:a},success:function(b){b.error==""?$("#NewTicket").slideUp("fast",function(){$("#TicketsUpdates").after("<div id='TicketClosedMessage'>This ticket has been closed.</div>");$("#TicketCloseLink").hide();$("#YourTickets a").removeClass("EvenRowItem");$("#YourTickets a:even").addClass("EvenRowItem");
$(this).hide()}):FList.Common_displayError(b.error)},error:function(b,c,d){FList.Common_displayError("Error: "+c+", "+d)}})};
FList.Ticket_open=function(a){confirm("Are you sure you want to reopen this ticket?")&&$.ajax({type:"GET",url:domain+"json/renewTicket.json",dataType:"json",timeout:timeoutsec*1E3,data:{ticket_id:a},success:function(b){if(b.error==""){$("#TicketClosedMessage").remove();$("#TicketOpenLink").hide();$("#TicketsUpdates").after("<div id='TicketClosedMessage'>This ticket has been re-opened, refresh to modify it.</div>")}else FList.Common_displayError(b.error)},error:function(b,c,d){FList.Common_displayError("Error: "+
c+", "+d)}})};
FList.Ticket_update=function(){var a=$("#VarCharacterId").val(),b=$("#VarTicketText").val(),c=$("#VarURL").val(),d=$("#CharacterUseGmail:checked").length>0?1:0,e=$("#PostAsComment:checked").length>0?1:0,f=$("#VarTicketId").val();$.ajax({type:"POST",url:domain+"json/ticketUpdate.json",dataType:"json",timeout:timeoutsec*1E3,data:{character_id:a,message:b,url:c,ticket_id:f,gmail:d,comment:e},success:function(g){if(g.error==""){$("#VarTicketText").val("");$("#TicketsUpdates #DisplayedMessage").remove();$("#TicketsUpdates").append('<div class="TicketUpdate MediumPanel" id = "TicketUpdate'+
g.update_id+'" style="display:none;"><a name="TicketUpdate'+g.update_id+'"></a><a href="'+domain+"c/"+g.friendlyname+'" class="TicketAvatarLink"><img src="'+staticdomain+"images/avatar/"+g.friendlyname+'.png" class="TicketAvatar"/></a><a class="remove" onclick="FList.Ticket_removeReply('+g.update_id+');"></a><div class="TicketDateTime"><a href="#TicketUpdate'+g.update_id+'" class="ParsedLink ImageLink"></a>Added '+g.datetime_added+"</i></div>"+FList.TagParser.parseEverything(g.message)+"</div>");
g.url!==""&&$(".TicketUpdate:last .TicketDateTime").after("<strong>URL:</strong>"+g.url+"<br />");g.admin_update==1&&$(".TicketUpdate:last").addClass("TicketAdminUpdate");g.comment==1&&$(".TicketUpdate:last").css({border:"2px dotted rgba(0,0,0,0.5)",padding:"10px",background:"rgba(255,255,255,0.8)",color:"#000"});$(".TicketUpdate:last").show("fast")}else FList.Common_displayError(g.error)},error:function(g,m,r){FList.Common_displayError("update failed; try again. Error:"+r)}})};var currentFeedOffset=[];currentFeedOffset[0]=0;currentFeedOffset[1]=0;var feedtypes=[],bmoffset=0,trackoffset=0;feedtypes[0]="newthreads";feedtypes[1]="newposts";function nextFeed(a){currentFeedOffset[a]+=20;loadFeeds(a)}function prevFeed(a){if(currentFeedOffset[a]>0){currentFeedOffset[a]-=20;loadFeeds(a)}}function bmNext(){bmoffset+=20;loadBookmarks()}function bmPrev(){if(bmoffset>0){bmoffset-=20;loadBookmarks()}}function nextTracks(){trackoffset+=20;loadTracks()}
function prevTracks(){if(trackoffset>0){trackoffset-=20;loadTracks()}}
function loadBookmarks(){$("#fptabcontent_bookmarks").show();$("#bookmarks_content").html("");$("#Content").addClass("BusyTab");$.ajax({type:"GET",url:domain+"json/getBookmarks.json",dataType:"json",timeout:timeoutsec*1E3,data:"offset="+bmoffset+"&amount=20",success:function(a){$("#Content").removeClass("BusyTab");if(a.error==""){$("#fptabcontent_bookmarks h3").html("Bookmarked users [page "+(bmoffset/20+1)+"]");$.each(a.characters,function(b,c){$("#bookmarks_content").append("<div id='TrackingCharacter"+
c.character_id+"' class='Messagecenter_Message TrackingCharacter'><a class='BookmarkRemove' id='CharacterTrackingRemove"+c.character_id+"' onclick=\"FList.Frontpage_Untrack('"+c.character_id+"');\"></a><img src='"+staticdomain+"images/avatar/"+c.name.toLowerCase()+".png'/><a href='c/"+c.name+"'>"+c.name+"</a></div>")});$("#fptabcontent_bookmarks").fadeIn("fast")}else FList.Common_displayError(a.error)},error:function(a,b,c){FList.Common_displayError("Failed. Error:"+b+", "+c)}})}
function loadTracks(){$.ajax({type:"GET",url:domain+"json/getTrackedThreads.json",dataType:"json",timeout:timeoutsec*1E3,data:"amount=20&offset="+trackoffset,success:function(a){$("#Content").removeClass("BusyTab");if(a.error==""){$("#fptabcontent_threads").html("<h3>Tracked threads [page "+(trackoffset/20+1)+"]</h3>");$.each(a.threads,function(b,c){$("#fptabcontent_threads").append('<div class="TrackingThread" id="TrackingThread'+c.threadsubscription_id+'"><a class="TrackingRemove" id="ThreadTrackingRemove'+
c.threadsubscription_id+'" onclick="FList.Tracking_untrackThread(\''+c.threadsubscription_id+"', '"+c.thread_id+'\');"></a><a href="thread.php?thread='+c.thread_id+'&offset=last#lastpost">'+c.subject+"</a></div>")});$("#fptabcontent_threads").append("<table class='content-navigation' cellpadding='0' cellspacing='0'><tr><td class='list-highlight'><a class='prev' onclick='prevTracks();'>Previous 20</a></td><td class='list-highlight'><a class='next' onclick='nextTracks();'>Next 20</a></td></tr></table>");
$("#fptabcontent_threads").fadeIn("fast")}else FList.Common_displayError(a.error)},error:function(a,b,c){FList.Common_displayError("Failed. Error:"+b+", "+c)}})}
function loadFeeds(a){$("#fptabcontent_"+feedtypes[a]).hide();$.ajax({type:"GET",url:domain+"json/getFeed.json",dataType:"json",timeout:timeoutsec*1E3,data:"tab="+feedtypes[a]+"&amount=20&offset="+currentFeedOffset[a],success:function(b){$("#Content").removeClass("BusyTab");if(b.error==""){if(feedtypes[a]=="newthreads"){$("#fptabcontent_newthreads").html("<h3>New threads in your joined groups [page "+(currentFeedOffset[a]/20+1)+"]</h3>");$.each(b.threads,function(c,d){$("#fptabcontent_newthreads").append('<div class="TrackingThread" id="TrackingThread'+
d.threadsubscription_id+'"><a href="thread.php?thread='+d.thread_id+'&offset=last#lastpost">'+d.subject+"</a>, created "+d.datetime_posted+' in <a href="group.php?group='+d.groupname+'">'+d.groupname+'</a> by <a  href="c/'+d.name+'/">'+d.name+"</a></div>")})}if(feedtypes[a]=="newposts"){$("#fptabcontent_newposts").html("<h3>New Posts in your joined groups [page "+(currentFeedOffset[a]/20+1)+"]</h3>");$.each(b.posts,function(c,d){$("#fptabcontent_newposts").append('<div class="TrackingPost">Posted in <a href="thread.php?thread='+
d.thread_id+'">'+d.subject+"</a>, "+d.datetime_posted+' in <a href="group.php?group='+d.groupname+'">'+d.groupname+'</a> by <a  href="c/'+d.name+'/">'+d.name+"</a><br/>"+d.message+"</div>")})}$("#fptabcontent_"+feedtypes[a]).append("<table class='content-navigation' cellpadding='0' cellspacing='0'><tr><td class='list-highlight'><a class='prev' onclick='prevFeed("+a+");'>Previous 20</a></td><td class='list-highlight'><a class='next' onclick='nextFeed("+a+");'>Next 20</a></td></tr></table>");$("#fptabcontent_"+
feedtypes[a]).fadeIn("fast")}else FList.Common_displayError(b.error)},error:function(b,c,d){FList.Common_displayError("Failed. Error:"+c+", "+d)}})}
function loadFPtab(a){$("#fptabcontent_chat, #fptabcontent_twitter, #fptabcontent_personals, #fptabcontent_staff, #fptabcontent_donate, #fptabcontent_newthreads, #fptabcontent_newposts, #fptabcontent_bookmarks, #fptabcontent_threads").hide();if(a=="chat"){$("#fptabcontent_chat").fadeIn("fast");$("#Content").removeClass("BusyTab")}if(a=="bookmarks"){bmoffset=0;loadBookmarks()}if(a=="personals"){bmoffset=0;loadPersonals()}if(a=="donate"){$("#fptabcontent_donate").fadeIn("fast");$("#Content").removeClass("BusyTab")}if(a==
"staff"){$("#fptabcontent_staff").fadeIn("fast");$("#Content").removeClass("BusyTab")}if(a=="threads"){trackoffset=0;loadTracks()}if(a=="feeds"){currentFeedOffset[0]=0;loadFeeds(0)}if(a=="feeds2"){currentFeedOffset[1]=0;loadFeeds(1)}a=="twitter"&&$("#fptabcontent_twitter").html("<h3>flistdotnet Tweets").getTwitter({userName:"flistdotnet",numTweets:5,loaderText:"Loading tweets...",slideIn:false,showHeading:false,showProfileLink:true});$("#Sidebar a").removeClass("active");$("#fbtab_"+a).addClass("active")}
FList.Frontpage_newspostsNext=function(){if(FList.Frontpage_newsOffset>0){FList.Frontpage_newsOffset-=2;FList.Frontpage_loadNewsposts()}};FList.Frontpage_newspostsPrevious=function(){FList.Frontpage_newsOffset+=2;FList.Frontpage_loadNewsposts()};
FList.Frontpage_loadNewsposts=function(){$.ajax({type:"POST",url:domain+"json/getNewsposts.json",dataType:"json",timeout:timeoutsec*1E3,data:{offset:FList.Frontpage_newsOffset},success:function(a){if(a.error==""){$("#Frontpage_NewspostData").html("");$("#Frontpage_NewspostData").hide().fadeIn("fast");$.each(a.posts,function(b,c){$("#Frontpage_NewspostData").append("<div class='Frontpage_Newspost'><h3 class='Frontpage_NewspostTitle'>"+c.title+"</h3> by <a class='ImageLink CharacterLink' href='"+domain+
"c/"+c.friendlyname+"'>"+c.name+"</a>, <span class='Frontpage_NewspostDate'>"+c.datetime_posted+"</span> <a href='newspost/"+c.newspost_id+"/' class='Frontpage_NewspostComments'>Reply</a> ("+c.commentcount+" comments)<br/><span class='NewspostPreview'>"+FList.TagParser.parseEverything(c.preview)+"<br/><br/><a href='newspost/"+c.newspost_id+"/' class='Frontpage_NewspostReadMore'>Read more...</a></span></div>")})}else FList.Common_displayError(a.error)},error:function(a,b,c){FList.Common_displayError(b+
", "+c);$("#Frontpage_NewspostData").show("fast")}})};
FList.Frontpage_Untrack=function(a){if(confirm("Are you sure you want to remove this character from your bookmarks?")){$("#CharacterTrackingRemove"+a).addClass("BusyTab");$.ajax({type:"POST",url:domain+"json/userTrack.json",dataType:"json",timeout:timeoutsec*1E3,data:{dest_character_id:a,csrf_token:FList.csrf_token()},success:function(b){b.error==""?$("#TrackingCharacter"+a).hide("fast",function(){$(this).remove()}):FList.Common_displayError(b.error)},error:function(b,c,d){FList.Common_displayError("Error:"+
c+", "+d)}})}};
function loadPersonals(){$("#fptabcontent_personals").show();$("#personals_content").html("");$("#Content").addClass("BusyTab");$.ajax({type:"GET",url:domain+"json/personals-get.json",dataType:"json",timeout:timeoutsec*1E3,success:function(a){$("#Content").removeClass("BusyTab");if(a.error==""){a.parser=FList.TagParser.parseEverything;var b=$.templates("#roleplayAdsTemplate");$("#personals_content").html(b.render(a));$("#fptabcontent_personals").fadeIn("fast")}else FList.Common_displayError(a.error)},error:function(a,
b,c){FList.Common_displayError("Failed. Error:"+b+", "+c)}})};FList.Messages_delete=function(a){$("#Messagecenter_Deletelink"+a).addClass("Busy");$.ajax({type:"GET",url:domain+"json/deleteMessage.json",dataType:"json",timeout:timeoutsec*1E3,data:{message_id:a},success:function(b){if(b.error=="")$("#Messagecenter_Message"+a).hide("fast",function(){$(this).remove();$("#message-expanded-"+a).remove();$(".Messagecenter_Message").removeClass("EvenRowItem");$(".Messagecenter_Message:even").addClass("EvenRowItem")});else{$("#Messagecenter_Deletelink"+a).removeClass("Busy");
FList.Common_displayError(b.error)}},error:function(b,c,d){$("#Messagecenter_Deletelink"+a).removeClass("Busy");FList.Common_displayError(c+", "+d)}})};
FList.Messages_trash=function(){var a=$("#VarMessageShow").val();if(confirm("Are you sure you want to delete all your messages?\nYou cannot undo this!")){$(".Messagecenter_Trashall").addClass("Busy");$.ajax({type:"GET",url:domain+"json/trashMessages.json",dataType:"json",timeout:timeoutsec*1E3,data:{type:a},success:function(b){if(b.error==""){$(".Messagecenter_Trashall").removeClass("Busy");a=="all"?$(".Messagecenter_Message").hide("fast"):$(".MessagesGroup"+a).hide("fast");$(".message-expanded").remove()}else{$(".Messagecenter_Trashall").removeClass("Busy");
FList.Common_displayError("Message clearing failed: "+b.error)}},error:function(b,c,d){FList.Common_displayError("Message clearing failed; "+c+":"+d);$(".Messagescenter_Trashall").removeClass("Busy")}})}};FList.Tracking_untrackThread=function(a,b){$("#ThreadTrackingRemove"+a).addClass("Busy");$.ajax({type:"POST",url:domain+"json/threadSubscribe.json",dataType:"json",timeout:timeoutsec*1E3,data:{thread_id:b,csrf_token:FList.csrf_token()},success:function(c){c.error==""?$("#TrackingThread"+a).hide("fast",function(){$(this).remove();$(".TrackingThread").removeClass("EvenRowItem");$(".TrackingThread:even").addClass("EvenRowItem")}):FList.Common_displayError(c.error)},error:function(c,d,e){FList.Common_displayError("Error: "+
d+":"+e)}})};
FList.Thread_subscribe=function(a){$("#Thread_SubscribeLink").removeClass("Thread_SubscribeLink").removeClass("Thread_UnsubscribeLink").addClass("Busy");$.ajax({type:"POST",url:domain+"json/threadSubscribe.json",dataType:"json",timeout:timeoutsec*1E3,data:{thread_id:a,csrf_token:FList.csrf_token()},success:function(b){$("#Thread_SubscribeLink").removeClass("Busy");if(b.error==""){if(b.subscribed=="yes"){$("#Thread_SubscribeLink").removeClass("Thread_SubscribeLink");$("#Thread_SubscribeLink").addClass("Thread_UnsubscribeLink");$("#Thread_SubscribeLink").html("Untrack thread")}if(b.subscribed==
"no"){$("#Thread_SubscribeLink").removeClass("Thread_UnsubscribeLink");$("#Thread_SubscribeLink").addClass("Thread_SubscribeLink");$("#Thread_SubscribeLink").html("Track thread")}}else FList.Common_displayError(b.error)},error:function(b,c,d){FList.Common_displayError("Error: "+c+":"+d)}})};
FList.Thread_invite=function(a){var b=$("#Thread_Controlsbox .private input").val();$.ajax({type:"POST",url:domain+"json/threadInvite.json",dataType:"json",timeout:timeoutsec*1E3,data:{thread_id:a,name:b,csrf_token:FList.csrf_token()},success:function(c){if(c.error==""){$("#Thread_Controlsbox .private a.character").val("");FList.Common_displayNotice("The character has been invited.");$("#Thread_Controlsbox .private div").append(b+"<br/>")}else FList.Common_displayError(c.error)},error:function(c,
d,e){FList.Common_displayError("Failed. Error:"+d+", "+e)}})};
FList.Thread_deletePost=function(a){confirm("Are you sure you want to delete this post?")&&$.ajax({type:"POST",url:domain+"json/deletePost.json",dataType:"json",timeout:timeoutsec*1E3,data:{post_id:a,csrf_token:FList.csrf_token()},success:function(b){b.error==""?$("#Thread_Post"+a).hide("fast",function(){$(this).remove();$(".Thread_Post").removeClass("EvenRowItem");$(".Thread_Post:even").addClass("EvenRowItem")}):FList.Common_displayError(b.error)},error:function(b,c,d){FList.Common_displayError("Error: "+
c+", "+d)}})};FList.Thread_setTitle=function(a){var b=$("#Thread_Subject").html(),c=prompt("Please enter a new title?",b);c!==null&&c!==""&&$.ajax({type:"POST",url:domain+"json/setThreadTitle.json",dataType:"json",timeout:timeoutsec*1E3,data:{thread_id:a,title:c,csrf_token:FList.csrf_token()},success:function(d){d.error==""?$("#Thread_Subject").html(c):FList.Common_displayError(d.error)},error:function(d,e,f){FList.Common_displayError("Error: "+e+", "+f)}})};
FList.Manager_initForumManager=function(){FList.Manager_currentForum=0;$("#GroupForums").sortable({placeholder:"GroupForumPlaceholder",distance:10,update:function(){var a=$("#GroupForums").sortable("serialize"),b=$("#VarGroupId").val();$("#OrderStatusLabel").html("Saving...");$.ajax({type:"POST",url:domain+"json/forumsSetOrder.json",dataType:"json",timeout:timeoutsec*1E3,data:{orders:a,group_id:b,csrf_token:FList.csrf_token()},success:function(c){c.error==""?$("#OrderStatusLabel").html("Done."):$("#OrderStatusLabel").html("Error: "+
c.error)},error:function(c,d,e){$("#OrderStatusLabel").html("Error: "+d+", "+e)}})}});$("#GroupForums").disableSelection()};
FList.Manager_toggleForumPublic=function(a){$.ajax({type:"POST",url:domain+"json/toggleForumPublic.json",dataType:"json",timeout:timeoutsec*1E3,data:{forum_id:a,csrf_token:FList.csrf_token()},success:function(b){if(b.error==""){if(b["public"]=="yes"){$("#EditableForumPublic"+a).removeClass("EditableForumNotPublic");$("#EditableForumPublic"+a).addClass("EditableForumPublic")}if(b["public"]=="no"){$("#EditableForumPublic"+a).removeClass("EditableForumPublic");$("#EditableForumPublic"+a).addClass("EditableForumNotPublic")}}else FList.Common_displayError(b.error)},
error:function(b,c,d){FList.Common_displayError("Failed. Error:"+c+", "+d)}})};
FList.Manager_toggleForumPrivate=function(a){$.ajax({type:"POST",url:domain+"json/toggleForumPrivate.json",dataType:"json",timeout:timeoutsec*1E3,data:{forum_id:a,csrf_token:FList.csrf_token()},success:function(b){if(b.error==""){if(b.allow_private=="yes"){$("#EditableForumPrivate"+a).removeClass("EditableForumNotPrivate");$("#EditableForumPrivate"+a).addClass("EditableForumPrivate")}if(b.allow_private=="no"){$("#EditableForumPrivate"+a).removeClass("EditableForumPrivate");$("#EditableForumPrivate"+
a).addClass("EditableForumNotPrivate")}}else FList.Common_displayError(b.error)},error:function(b,c,d){FList.Common_displayError("Failed. Error:"+c+", "+d)}})};
FList.Manager_deleteForum=function(a){confirm("Are you sure you want to delete this forum?")&&$.ajax({type:"POST",url:domain+"json/deleteForum.json",dataType:"json",timeout:timeoutsec*1E3,data:{forum_id:a,csrf_token:FList.csrf_token()},success:function(b){b.error==""?$("#EditableGroupForum_"+a).hide("fast",function(){$("#EditableGroupForum_"+a).remove();$(".EditableGroupForum").removeClass("EvenRowItem");$(".EditableGroupForum:even").addClass("EvenRowItem")}):FList.Common_displayError(b.error)},error:function(b,
c,d){FList.Common_displayError("Failed. Error:"+c+", "+d)}})};
FList.Manager_setForumName=function(a){var b=$("#EditableForumName"+a).html(),c=prompt("Please enter a new name?",b);c!==null&&c!==""&&$.ajax({type:"POST",url:domain+"json/setForumName.json",dataType:"json",timeout:timeoutsec*1E3,data:{forum_id:a,name:c,csrf_token:FList.csrf_token()},success:function(d){d.error==""?$("#EditableForumName"+a).html(c):FList.Common_displayError(d.error)},error:function(d,e,f){FList.Common_displayError("Failed. Error:"+f)}})};
FList.Manager_openForumDescriptionDialog=function(a){FList.Manager_currentForum=a;$("#ForumDescriptionEdit"+a).addClass("Busy");$.ajax({type:"GET",url:domain+"json/getForum.json",dataType:"json",timeout:timeoutsec*1E3,data:{forum_id:a},success:function(b){$("#ForumDescriptionEdit"+a).removeClass("Busy");FList.Common_multiLinePrompt("Enter a new forum description",b.description,"Update description",FList.Manager_setForumDescription)},error:function(b,c,d){FList.Common_displayError("Failed. Error:"+
d);$("#ForumDescriptionEdit"+a).removeClass("Busy")}})};FList.Manager_setForumDescription=function(a){var b=FList.Manager_currentForum;$.ajax({type:"POST",url:domain+"json/setForumDescription.json",dataType:"json",timeout:timeoutsec*1E3,data:{forum_id:b,description:a,csrf_token:FList.csrf_token()},success:function(c){c.error==""?$("#EditableForumDescription"+b).html(a):FList.Common_displayError(c.error)},error:function(c,d,e){FList.Common_displayError("Error:"+d+", "+e)}})};FList.Notes={writeDialog:0,folderDialog:0,renameDialog:0,moveDialog:0,reportDialog:0,filtersDialog:0,init:function(){FList.Notes.bindFolderButtons();var a=FList.Common_getCookie("notes.amount");if(a!==""){a=parseInt(a);FList.Notes.amount=isNaN(a)?10:a}$(".dpc"+FList.Notes.amount).css("font-weight","bold");FList.Notes.switchFolder(1);if($("#VarLinkNoteRecipient").val()!==""){a=$("#VarLinkNoteRecipient").val();var b,c;if($("#VarLinkNoteBlock").val()==="true"){b="(STAFF NOTE) Profile blocked from viewing.";
c="Your profile has been temporarily blocked from viewing by the public for the following reason:\n";c+=$("#VarLinkNoteBlockReason").val();c+="\n\n\nTo lift the block automatically, edit the profile (as instructed, if it requires editing on your part). Thank you!\n[b][color=red](( Do not respond to this note - If you wish to contest the block for any reasons, please [url=https://www.f-list.net/tickets2.php]submit a Helpdesk ticket[/url] to do so. ))[/color][/b]"}FList.Notes.openWriteDialog(a,b,c)}},
bindFolderButtons:function(){$(".NoteFolder").unbind("click").click(function(a){var b=parseInt(this.id.substring(10));a.preventDefault();if(isNaN(b)){a=this.id.substring(10).toLowerCase();FList.Notes.switchView(a)}else FList.Notes.switchFolder(b)});$(".NoteFolder .edit").unbind("click").click(function(a){var b=this.id.substring(4);a.stopPropagation();FList.Notes.openRenameDialog(b)});$(".NoteFolder .delete").unbind("click").click(function(a){var b=this.id.substring(6);a.stopPropagation();FList.Notes.deleteFolder(b)})},
offset:0,folder:1,total:0,amount:10,activeView:"notes",folderList:[],switchView:function(a){$(".NoteFolder").removeClass("list-active");FList.Notes.activeView=a;if(a=="starred"){$("#Note_PageHeader span.current").html("Starred");$("#NoteFolderStarred").addClass("list-active");$("#buttons-star").hide();$("#buttons-mark-unread").fadeIn("fast")}else if(a=="unread"){$("#Note_PageHeader span.current").html("Unread");$("#NoteFolderUnread").addClass("list-active");$("#buttons-star").fadeIn("fast");$("#buttons-mark-unread").hide()}else if(a==
"searchuser"){$("#Note_PageHeader span.current").html("Search, "+FList.Notes.query);$("#buttons-star, #buttons-mark-unread").fadeIn("fast")}else if(a=="searchcontent"){$("#Note_PageHeader span.current").html("Search, "+FList.Notes.query);$("#buttons-star, #buttons-mark-unread").fadeIn("fast")}FList.Notes.folder=1;FList.Notes.offset=0;FList.Notes.read();$("#buttons-empty-trash").hide();$("#buttons-undelete, #buttons-trash, #buttons-move").fadeIn("fast")},switchFolder:function(a){FList.Notes.activeView=
"notes";FList.Notes.folder=a;FList.Notes.offset=0;FList.Notes.read();$(".NoteFolder").removeClass("list-active");$(".NoteFolder"+a).addClass("list-active");var b=$(".NoteFolder"+a+" .name").text();$("#Note_PageHeader span.current").html(b);if(a==3){$("#buttons-empty-trash").fadeIn("fast");$("#buttons-undelete").fadeIn("fast");$("#buttons-move").hide("fast");$("#buttons-trash").hide()}else{$("#buttons-empty-trash").hide();$("#buttons-trash").fadeIn("fast");$("#buttons-move").fadeIn("fast");$("#buttons-undelete").hide()}$("#buttons-star, #buttons-mark-unread").fadeIn("fast")},
searchUser:function(a){FList.Notes.query="user:"+a;FList.Notes.switchView("searchuser")},searchContent:function(a){FList.Notes.query="query:"+a;FList.Notes.switchView("searchcontent")},selectAll:function(){$(".CheckNote input").prop("checked",true);$(".CheckNote").addClass("check-true");FList.Notes.lastID=0},selectNone:function(){$(".CheckNote input").prop("checked",false);$(".CheckNote").removeClass("check-true");FList.Notes.lastID=0},emptyTrash:function(){if(confirm("Are you sure? The notes will be purged forever.")){$("#buttons-empty-trash").button("disable");
$("#Note_PageHeader").addClass("Busy");FList.Common_ajax({url:"json/notes-emptytrash.json",type:"POST",dataType:"json",data:{csrf_token:FList.csrf_token()},onSuccess:function(){FList.Notes.folder==3&&FList.Notes.activeView=="notes"&&FList.Notes.read();FList.Notes.updateCount(3,0,0)},onEither:function(){$("#buttons-empty-trash").button("enable");$("#Note_PageHeader").removeClass("Busy")}})}},markSelectedRead:function(a){var b=FList.Notes.getSelected();$("#Note_PageHeader").addClass("Busy");a==1&&$("#buttons-mark-read").button("disable");
a==0&&$("#buttons-mark-unread").button("disable");FList.Common_ajax({url:"json/notes-setread.json",type:"POST",data:{notes:b,csrf_token:FList.csrf_token(),state:a,folder_id:FList.Notes.activeView=="notes"?FList.Notes.folder:1},onSuccess:function(c){FList.Notes.read();FList.Notes.activeView=="notes"?FList.Notes.updateCount(FList.Notes.folder,c.total,c.unread):FList.Notes.refreshAllCounts()},onEither:function(){$("#buttons-mark-read, #buttons-mark-unread").button("enable");$("#Note_PageHeader").removeClass("Busy")}})},
starSelected:function(a){var b=FList.Notes.getSelected();$("#Note_PageHeader").addClass("Busy");a==1&&$("#buttons-star").button("disable");a==0&&$("#buttons-destar").button("disable");FList.Common_ajax({url:"json/notes-setstarred.json",type:"POST",data:{notes:b,state:a,csrf_token:FList.csrf_token()},onSuccess:function(){FList.Notes.read()},onEither:function(){$("#Note_PageHeader").removeClass("Busy");$("#buttons-star, #buttons-destar").button("enable")}})},trashSelected:function(){var a=FList.Notes.getSelected();
$("#Note_PageHeader").addClass("Busy");$("#buttons-trash").button("disable");FList.Common_ajax({url:"json/notes-trash.json",type:"POST",data:{notes:a,csrf_token:FList.csrf_token()},onSuccess:function(b){FList.Notes.read();$.each(b.counts,function(c,d){FList.Notes.updateCount(d.folder,d.total,d.unread)})},onEither:function(){$("#Note_PageHeader").removeClass("Busy");$("#buttons-trash").button("enable")}})},setAmount:function(a){FList.Notes.amount=a;FList.Common_setCookie("notes.amount",a,7);$(".dpc").css("font-weight",
"normal");$(".dpc"+FList.Notes.amount).css("font-weight","bold");FList.Notes.read()},undeleteSelected:function(){var a=FList.Notes.getSelected();$("#Note_PageHeader").addClass("Busy");$("#buttons-undelete").button("disable");FList.Common_ajax({url:"json/notes-setfolder.json",type:"POST",data:{notes:a,folder_id:1,csrf_token:FList.csrf_token()},onSuccess:function(b){FList.Notes.read();$.each(b.counts,function(c,d){FList.Notes.updateCount(d.folder,d.total,d.unread)})},onEither:function(){$("#Note_PageHeader").removeClass("Busy");
$("#buttons-undelete").button("enable")}})},moveSelected:function(a){var b=FList.Notes.getSelected();$("#Note_PageHeader").addClass("Busy");$("#buttons-move").button("disable");$("#dialog-move-move").button("option","label","Moving...");$("#dialog-move-move, #dialog-move-cancel").button("disable");FList.Common_ajax({url:"json/notes-setfolder.json",type:"POST",data:{notes:b,folder_id:a,csrf_token:FList.csrf_token()},onSuccess:function(c){FList.Notes.moveDialog.dialog("close");FList.Notes.read();$.each(c.counts,
function(d,e){FList.Notes.updateCount(e.folder,e.total,e.unread)})},onEither:function(){$("#dialog-move-move, #dialog-move-cancel").button("enable");$("#dialog-move-move").button("option","label","Move");$("#Note_PageHeader").removeClass("Busy");$("#buttons-move").button("enable")}})},refreshAllCounts:function(){$("#Note_PageHeader").addClass("Busy");FList.Common_ajax({url:"json/notes-getfolders.json",data:{notes:items,folder_id:_folder},onSuccess:function(a){$.each(a.folders,function(b,c){FList.Notes.updateCount(c.folder_id,
c.notecount,c.unreadcount)})},onEither:function(){$("#Note_PageHeader").removeClass("Busy")}})},getSelected:function(){var a=[];$(".CheckNote").each(function(){if($(this).children("input").attr("checked")=="checked"){var b=this.id.substring(9);a.push(b)}});return a},getPageCount:function(){return Math.floor((FList.Notes.total-1)/FList.Notes.amount+1)},getCurrentPageNumber:function(){return Math.floor(FList.Notes.offset/FList.Notes.amount+1)},getVisiblePageRange:function(){var a={start:1,stop:FList.Notes.getPageCount()},
b=FList.Notes.getPageCount();if(b>11){var c=FList.Notes.getCurrentPageNumber();a={start:1,stop:b};if(c>6){a.start+=c-6;a.stop+=c-6;if(a.stop>c+5)a.stop=c+5;if(a.stop>b)a.stop=b}}return a},getPageString:function(){for(var a=FList.Notes.getVisiblePageRange(),b=FList.Notes.getCurrentPageNumber(),c="",d=a.start;d<=a.stop;d++)c+=d==b?"<b>["+d.toString()+"]</b> | ":"<a href='#' onclick='FList.Notes.goToPage("+d.toString()+");'>"+d.toString()+"</a> | ";return c.substring(0,c.length-3)},read:function(){FList.Notes.lastID=
0;$("#Note_Box").html("").hide();$(".content-navigation").hide();$("#Note_PageHeader").addClass("Busy");var a="notes-get.json",b={offset:FList.Notes.offset,amount:FList.Notes.amount,folder:FList.Notes.folder};if(FList.Notes.activeView=="starred")a="notes-getstarred.php";if(FList.Notes.activeView=="searchuser"){a="notes-searchuser.json";_name=FList.Notes.query.split(":")[1];b={offset:FList.Notes.offset,amount:FList.Notes.amount,name:_name}}if(FList.Notes.activeView=="searchcontent"){a="notes-searchcontent.json";
_query=FList.Notes.query.split(":")[1];b={offset:FList.Notes.offset,amount:FList.Notes.amount,query:_query}}if(FList.Notes.activeView=="unread")a="notes-getunread.json";FList.Common_ajax({url:"json/"+a,data:b,onSuccess:function(c){$("#Note_Box").html("");FList.Notes.total=c.total;$(".nav-position").html(FList.Notes.getPageString());$.each(c.notes,function(d,e){$("#Note_Box").append('<span class="CheckNote panel list-highlight" id="CheckNote'+e.note_id+'"><span></span><input type="checkbox" name="Note_'+
e.note_id+'"></span>');var f=e.title;if(f.length>35)f=f.substring(0,35)+" [...]";$("#Note_Box").append('<a href="'+domain+"c/"+e.dest_name+'/"><img class="avatardest" src="'+staticdomain+"images/avatar/"+e.dest_name.toLowerCase()+'.png"/></a><a href="'+domain+"c/"+e.source_name+'/"><img class="avatarsource" src="'+staticdomain+"images/avatar/"+e.source_name.toLowerCase()+'.png"/></a><a href="view_note.php?note_id='+e.note_id+'"><div class="Note_Boxnote list-highlight" id="Note_Boxnote'+e.note_id+
'"><span class="receiver">'+e.dest_name+'</span><span class="star"></span><span class="sender">'+e.source_name+'</span> sent <span class="title">&quot;'+f+"&quot;</span>, "+e.datetime_sent+"</div></a>");e.starred==1&&$(".Note_Boxnote:last").addClass("Note_Starred");e.read==0&&$(".Note_Boxnote:last").addClass("Note_Unread");$("#CheckNote"+e.note_id).mousedown(function(g){FList.Notes.toggleSelection(e.note_id,g.shiftKey)})});$("#Note_Box").fadeIn("fast",function(){$(".content-navigation").show("fast")});
FList.Notes.getCurrentPageNumber()>FList.Notes.getPageCount()&&FList.Notes.getCurrentPageNumber()>1&&FList.Notes.goToPage(FList.Notes.getPageCount())},onEither:function(){$("#Note_PageHeader").removeClass("Busy")},onError:function(){$(".nav-position").html("");$("#Note_PageHeader span.nav").html("")}})},toggleSelection:function(a,b){$("#CheckNote"+a+" input").prop("checked",!$("#CheckNote"+a+" input").prop("checked"));var c=false;if(b)if(FList.Notes.lastID!==0){$(".CheckNote").each(function(){var d=
this.id.substring(9);if((a==d||FList.Notes.lastID==d)&&c==false){$("#CheckNote"+d+" input").prop("checked",true);$("#CheckNote"+d).addClass("check-true");return c=true}if(c==true){$("#CheckNote"+d+" input").prop("checked",true);$("#CheckNote"+d).addClass("check-true")}if((a==d||FList.Notes.lastID==d)&&c==true)return false});FList.Notes.lastID=0}if(c==false)if($("#CheckNote"+a+" input").prop("checked")){$("#CheckNote"+a).addClass("check-true");FList.Notes.lastID=a}else{$("#CheckNote"+a).removeClass("check-true");
FList.Notes.lastID=0}},send:function(a,b,c,d,e){$("#dialog-note-send").button("option","label","Sending...");$("#dialog-note-send, #dialog-note-close").button("disable");if(typeof e=="undefined")e=false;$("#Note_PageHeader").addClass("Busy");$("#Reply").button("disable");FList.Common_ajax({url:"json/notes-send.json",type:"POST",data:{title:a,message:b,dest:c,source:d,csrf_token:FList.csrf_token()},onSuccess:function(f){FList.Common_displayNotice("Your note was sent.");FList.Notes.writeDialog!==0&&
FList.Notes.writeDialog.dialog("close");FList.Notes.folder==2&&FList.Notes.activeView=="notes"&&FList.Notes.read();FList.Notes.updateCount(2,f.total,f.unread);if(e)location.href=domain+"read_notes.php"},onEither:function(){$("#dialog-note-send, #dialog-note-close").button("enable");$("#dialog-note-send").button("option","label","Send");$("#Reply").button("enable");$("#Note_PageHeader").removeClass("Busy")}})},updateCount:function(a,b,c){$(".NoteFolder"+a+" span.count").text(b);$(".NoteFolder"+a+" span.unread").text(c)},
markNoteRead:function(a,b,c){b==1&&$("#ToggleRead").button("disable");b==0&&$("#ToggleUnread").button("disable");$("#Note_PageHeader").addClass("Busy");FList.Common_ajax({url:"json/notes-setread.json",type:"POST",data:{notes:[a],state:b,folder_id:c,csrf_token:FList.csrf_token()},onSuccess:function(){if(b==1){$("#ToggleUnread").fadeIn("fast");$("#ToggleRead").hide()}else{$("#ToggleRead").fadeIn("fast");$("#ToggleUnread").hide()}},onEither:function(){$("#ToggleUnread, #ToggleRead").button("enable");
$("#Note_PageHeader").removeClass("Busy")}})},starNote:function(a,b){b==1&&$("#ToggleStarOn").button("disable");b==0&&$("#ToggleStarOff").button("disable");$("#Note_PageHeader").addClass("Busy");FList.Common_ajax({url:"json/notes-setstarred.json",type:"POST",data:{notes:[a],state:b,csrf_token:FList.csrf_token()},onSuccess:function(){if(b==1){$("#ToggleStarOff").fadeIn("fast");$("#ToggleStarOn").hide()}else{$("#ToggleStarOn").fadeIn("fast");$("#ToggleStarOff").hide()}},onEither:function(){$("#ToggleStarOn, #ToggleStarOff").button("enable");
$("#Note_PageHeader").removeClass("Busy")}})},trashNote:function(a){$("#Trash").button("disable");$("#Note_PageHeader").addClass("Busy");FList.Common_ajax({url:"json/notes-trash.json",type:"POST",data:{notes:[a],csrf_token:FList.csrf_token()},onSuccess:function(){$("#Undelete").fadeIn("fast");$("#Trash").hide()},onEither:function(){$("#Trash").button("enable");$("#Note_PageHeader").removeClass("Busy")}})},report:function(a,b){$("#Report").button("disable");$("#Note_PageHeader").addClass("Busy");FList.Common_ajax({url:"json/notes-report.json",
type:"POST",data:{note_id:a,reason:b,csrf_token:FList.csrf_token()},onSuccess:function(){FList.Notes.reportDialog.dialog("close");FList.Common_displayNotice("Note successfully reported. Thank you for bringing it to our attention!")},onEither:function(){$("#Note_PageHeader").removeClass("Busy");$("#Report").button("enable")}})},undeleteNote:function(a){$("#Undelete").button("disable");$("#Note_PageHeader").addClass("Busy");FList.Common_ajax({url:"json/notes-setfolder.json",type:"POST",data:{notes:[a],
folder_id:1,csrf_token:FList.csrf_token()},onSuccess:function(){$("#Trash").fadeIn("fast");$("#Undelete").hide()},onEither:function(){$("#Undelete").button("enable");$("#Note_PageHeader").removeClass("Busy")}})},addFolder:function(a){$("#Note_PageHeader").addClass("Busy");FList.Common_ajax({url:"json/notes-createfolder.json",type:"POST",data:{name:a,csrf_token:FList.csrf_token()},onSuccess:function(b){FList.Notes.folderDialog.dialog("close");$(".NoteFolder:last").after("<div style='display:none;' class='NoteFolder list-item NoteFolder"+
b.folder_id+" list-highlight' id ='NoteFolder"+b.folder_id+"'><span class='unread'>0</span><a class='delete' id='delete"+b.folder_id+"'></a><a class='edit' id='edit"+b.folder_id+"'></a><span class='name'>"+b.name+"</span><span class='count'>0</span></div>");$(".NoteFolder:last").fadeIn("fast");FList.Notes.bindFolderButtons()},onEither:function(){$("#Note_PageHeader").removeClass("Busy")}})},renameFolder:function(a,b){FList.Common_ajax({url:"json/notes-renamefolder.json",type:"POST",data:{folder:a,
name:b,csrf_token:FList.csrf_token()},onSuccess:function(c){$(".NoteFolder"+a+" span.name").text(c.name)},onEither:function(){$("#Note_PageHeader").removeClass("Busy")}})},deleteFolder:function(a){confirm("Are you sure? Any notes inside, if any, will be moved to the inbox, and any filters set to this folder will be deleted.")&&FList.Common_ajax({url:"json/notes-deletefolder.json",type:"POST",data:{folder:a,csrf_token:FList.csrf_token()},onSuccess:function(b){$("#Note_PageHeader").removeClass("Busy");
$(".NoteFolder"+a).fadeOut("fast",function(){$(this).remove()});a==FList.Notes.folder&&FList.Notes.switchFolder(1);FList.Notes.updateCount(1,b.total,b.unread)},onError:function(){$("#Note_PageHeader").removeClass("Busy")}})},readNext:function(){if(FList.Notes.offset<(FList.Notes.getPageCount()-1)*FList.Notes.amount){FList.Notes.offset+=FList.Notes.amount;FList.Notes.read()}},readFirst:function(){FList.Notes.offset=0;FList.Notes.read()},goToPage:function(a){a-=1;FList.Notes.offset=a*FList.Notes.amount;
FList.Notes.read()},readLast:function(){FList.Notes.offset=(FList.Notes.getPageCount()-1)*FList.Notes.amount;FList.Notes.read()},readPrevious:function(){if(FList.Notes.offset>=FList.Notes.amount){FList.Notes.offset-=FList.Notes.amount;FList.Notes.read()}},openMoveDialog:function(){if(FList.Notes.moveDialog==0){if(FList.Notes.getSelected().length==0){FList.Common_displayError("You have to select one or more notes to move.");return}FList.Notes.moveDialog=$('<div><div id="FolderBox" style="margin:0px -10px 0px -10px;"></div></div>');
FList.Notes.moveDialog.dialog({autoOpen:false,title:"Move notes to folder",width:"350",height:"400",modal:true,buttons:[{id:"dialog-move-move",text:"Move",click:function(){typeof FList.Notes.moveActiveFolder=="undefined"||FList.Notes.moveActiveFolder==null?FList.Common_displayError("You have to select a destination folder, or click cancel."):FList.Notes.moveSelected(FList.Notes.moveActiveFolder)}},{id:"dialog-move-cancel",text:"Cancel",click:function(){FList.Notes.moveDialog.dialog("close")}}]})}$("#buttons-move").button("disable");
$("#Note_PageHeader").addClass("Busy");FList.Notes.moveActiveFolder=null;FList.Common_ajax({url:"json/notes-getfolders.json",data:"",onSuccess:function(a){FList.Notes.moveDialog.dialog("open");$("#FolderBox").html("");$.each(a.folders,function(b,c){$("#FolderBox").append("<div class='list-highlight panel move-folder move-folder-"+c.folder_id+"' style='cursor:pointer;padding:10px;' onclick='FList.Notes.moveSelect("+c.folder_id+");'>"+c.name+"</div>")})},onEither:function(){$("#Note_PageHeader").removeClass("Busy");
$("#buttons-move").button("enable")}})},moveSelect:function(a){$(".move-folder").removeClass("list-active");$(".move-folder-"+a).addClass("list-active");FList.Notes.moveActiveFolder=a},openWriteDialog:function(a,b,c){var d=true;if(typeof a=="undefined"){a=b="";d=false}if(typeof b=="undefined")b="";if(typeof c=="undefined")c="";if(FList.Notes.writeDialog==0){FList.Notes.writeDialog=$('<div>Title: <input type="text" name="title" id="SendNoteTitle" maxlength="50"/><br/><textarea name="message" id="SendNoteMessage" style="width:500px;" maxlength="20000"></textarea><br/>Send to: <input type="text" name="dest" id="SendNoteDest" maxlength="40"/><br/>Send as: <select id="SendNoteCharacter"></select></div>');
FList.Notes.writeDialog.find("#SendNoteTitle").val(b);FList.Notes.writeDialog.find("#SendNoteDest").val(a);FList.Notes.writeDialog.find("#SendNoteMessage").val(c);FList.Notes.writeDialog.dialog({autoOpen:false,title:"Send a note",width:"600",height:"350",modal:true,buttons:[{id:"dialog-note-send",text:"Send",click:function(){FList.Notes.send($("#SendNoteTitle").val(),$("#SendNoteMessage").val(),$("#SendNoteDest").val(),$("#SendNoteCharacter").val())}},{id:"dialog-note-close",text:"Close",click:function(){FList.Notes.writeDialog.dialog("close");
$("#dialog-note-send, #dialog-note-close").attr("disabled",false)}}]})}FList.Notes.writeDialog.dialog("open");$("#SendNoteCharacter").html($("#NoteVarCharacters").html());if(d)$("#SendNoteMessage").focus();else{$("#SendNoteTitle, #SendNoteDest, #SendNoteCharacter").val("");$("#SendNoteTitle").focus();$("#SendNoteCharacter").val($("#NoteVarCharacters").val())}},openFolderDialog:function(){if(FList.Notes.folderDialog==0){FList.Notes.folderDialog=$('<div>Title: <input type="text" id="CreateFolderName" maxlength="20"/></div>');
FList.Notes.folderDialog.dialog({autoOpen:false,title:"Create a new folder",width:"250",height:"150",modal:true,buttons:{Create:function(){FList.Notes.addFolder($("#CreateFolderName").val())},Cancel:function(){FList.Notes.folderDialog.dialog("close")}}})}FList.Notes.folderDialog.dialog("open");$("#CreateFolderName").val("").focus()},openReportDialog:function(a){if(FList.Notes.reportDialog==0){FList.Notes.reportDialog=$('<div>Reason: <input type="text" id="ReportNoteReason" maxlength="1024"/></div>');
FList.Notes.reportDialog.dialog({autoOpen:false,title:"Report a note",width:"250",height:"150",modal:true,buttons:{"Send Report":function(){FList.Notes.report(a,$("#ReportNoteReason").val())},Cancel:function(){FList.Notes.reportDialog.dialog("close")}}})}FList.Notes.reportDialog.dialog("open");$("#ReportNoteReason").val("").focus()},openRenameDialog:function(a){FList.Notes.renameDialog!==0&&FList.Notes.renameDialog.dialog("close").dialog("destroy");FList.Notes.renameDialog=$("<div><b>Renaming "+$(".NoteFolder"+
a+" .name").text()+'</b><br/>Rename to: <input type="text" id="RenameFolderName"/></div>');FList.Notes.renameDialog.dialog({autoOpen:false,title:"Rename folder",width:"250",height:"170",modal:true,buttons:{Rename:function(){FList.Notes.renameFolder(a,$("#RenameFolderName").val());FList.Notes.renameDialog.dialog("close")},Cancel:function(){FList.Notes.renameDialog.dialog("close")}}});FList.Notes.renameDialog.dialog("open");$("#RenameFolderName").val("").focus()},prepareFilterDialog:function(){FList.Notes.folderList=
[];FList.Common_ajax({url:"json/notes-getfolders.json",onSuccess:function(a){$.each(a.folders,function(b,c){FList.Notes.folderList.push({id:c.folder_id,name:c.name})});FList.Common_ajax({url:"json/notes-getfilters.json",onSuccess:function(b){FList.Notes.openFiltersDialog(b.filters)},onError:function(){}})},onError:function(){}})},storeFilters:function(){var a=[];$(".filter-item").each(function(c,d){var e=$(d).find(".read").prop("checked")?1:0,f=$(d).find(".starred").prop("checked")?1:0,g=[],m=$(d).find(".filter-condition");
$(m).each(function(r,s){g.push({type:$(s).find(".type").val(),value:$(s).find(".value").val()})});a.push({folder_id:$(d).find(".folder-id").val(),read:e,starred:f,conditions:g})});var b=JSON.stringify(a);FList.Common_ajax({url:"json/notes-setfilters.json",type:"POST",data:{filters:b,csrf_token:FList.csrf_token()},onSuccess:function(){FList.Notes.filtersDialog.dialog("close")},onError:function(){}})},openFiltersDialog:function(a){if(FList.Notes.filtersDialog==0){FList.Notes.filtersDialog=$("<div>Seperate multiple values with commas. If more than one filter matches, the actions of the first match are applied.<br/><b>Note:</b> filters apply to new, incoming notes, for now.)<div id='FilterBox' style='margin:10px -13px 0px -13px;'></div></div>");
FList.Notes.filtersDialog.dialog({autoOpen:false,title:"Manage filters",width:"600",height:"500",modal:true,buttons:{"Add a filter":function(){if($(".filter-item").length>=10)FList.Common_displayError("You can only set ten filters at this point.");else{var b=1;if($(".filter-item").length>=1)b=parseInt($(".filter-item:last").attr("id").substring(11))+1;var c="";$.each(FList.Notes.folderList,function(d,e){c=c+"<option value='"+e.id+"'>"+e.name+"</option>"});$("#FilterBox").append('<div class="panel filter-item list-item" id="filter-item'+
b+'"><table><tr><td width="50%" style="padding:5px;"><a class="delete" onclick="$(\'#filter-item'+b+'\').remove();"></a><h3>Action</h3>Place in:<select class="filters-dest folder-id">'+c+'</select><input type="checkbox" class="check read"/>Read<input type="checkbox" class="check starred"/>Star</td><td width="50%" style="padding:5px;border-left:1px solid rgba(0,0,0,0.2);" class="filter-conditions"><a style="float:right;" class="add" onclick="FList.Notes.printFilterCondition('+b+');"></a><h3>Conditions</h3></td></tr></table></div>');
FList.Notes.printFilterCondition(b);$(".filters-dest:last").val(1)}},"Save Filters":function(){FList.Notes.storeFilters()},Close:function(){FList.Notes.filtersDialog.dialog("close")}}})}$("#FilterBox").html("");$.each(a,function(b,c){var d="";$.each(FList.Notes.folderList,function(e,f){d=d+"<option "+(c.folder_id==f.id?"selected":"")+" value='"+f.id+"'>"+f.name+"</option>"});$("#FilterBox").append('<div class="panel filter-item list-item" id="filter-item'+b+'"><table><tr><td width="50%" style="padding:5px;"><a class="delete" onclick="$(\'#filter-item'+
b+'\').remove();"></a><h3>Action</h3>Place in:<select class="filters-dest folder-id">'+d+'</select><input type="checkbox" class="check read" '+(c.read==1?"checked='checked'":"")+'/>Read<input type="checkbox" class="check starred" '+(c.starred==1?"checked='checked'":"")+'/>Star</td><td width="50%" style="padding:5px;border-left:1px solid rgba(0,0,0,0.2);" class="filter-conditions"><a style="float:right;" class="add" onclick="FList.Notes.printFilterCondition('+b+');"></a><h3>Conditions</h3></td></tr></table></div>');
$.each(c.conditions,function(e,f){FList.Notes.printFilterCondition(b,f.type,f.value)})});FList.Notes.filtersDialog.dialog("open")},clearFilterCondition:function(a,b){$("#filter-item"+a+" .filter-condition").length==1?FList.Common_displayError("There needs to be at least one condition, per filter."):$("#filter-item"+a+" .filter-condition"+b).remove()},printFilterCondition:function(a,b,c){if(typeof b=="undefined")b="";if(typeof c=="undefined")c="";if($("#filter-item"+a+" .filter-condition").length==
2)FList.Common_displayError("Two conditions per filter, max.");else{var d=1;if($("#filter-item"+a+" .filter-condition").length>=1)d=parseInt($("#filter-item"+a+" .filter-condition:last").attr("id").substring(16))+1;$("#filter-item"+a+" .filter-conditions").append('<div class="panel filter-condition filter-condition'+d+'" id="filter-condition'+d+'" style="padding:2px;"><a class="delete" onclick="FList.Notes.clearFilterCondition('+a+","+d+');"></a>Type: <select class="type"><option selected value="from-source" '+
(b=="from-source"||b==""?"selected":"")+'>From sender</option><option value="to-dest" '+(b=="to-dest"?"selected":"")+'>To recipient</option><option value="in-title" '+(b=="in-title"?"selected":"")+'>Title contains</option></select>Value:<input type="text" value="'+c+'"class="value text" maxlength="256"/></div>');$("#filter-item"+a+" .filter-condition"+d).find(".value").bind("keydown",function(e){if(e.which==188){var f=$(this).val();if(FList.Notes.validateFilterCondition(f)==false){e.preventDefault();
FList.Common_displayError("Only enter 10 words/names per condition max.")}}})}},validateFilterCondition:function(a){return a.split(",").length-1>=9?false:true}};function CloseCommentBox(){$(".CommentForm").slideUp("fast",function(){$(this).remove()})}FList.Vote_postRootComment=function(a,b,c){$("#post-root-comment").val("Posting...").attr("disabled",true);FList.Common_postComment(a,b,c,0,"feature",function(d){$("#post-root-comment").attr("disabled",false).val("Submit comment");d&&$("#VarCommentMessage").val("")})};
function CreateCommentBox(a,b,c){$(".CommentForm").remove();if(a==0){b="Post a new comment";var d="Post Comment"}else{b="Reply to this comment";d="Post Reply"}c='<form class="CommentForm LightPanel StyledForm"><a onclick="CloseCommentBox();" class="CommentboxCloseLink"></a><h3><span></span>'+b+'</h3><input type="hidden" id="CommentParent" value="'+a+'"/><input type="hidden" id="CommentType" value="0"/><input type="hidden" id="CommentDestinationId" value="'+c+'"/><p><span class="label">Character</span><span class="element"><select id="CommentCharacter"><option value=""></option></select></span></p><b>Message:</b><textarea id="CommentMessage"></textarea><br/><br/><input type="button" onclick="PostComment();" value="'+
d+'"/></form>';a==0?$("#CommentReplyBox").html(c):$("#comment"+a).append(c);$("#CommentCharacter").html($("#CharacterData").html());FList.Common_Autoselect();$(".CommentForm").slideDown("fast")}
FList.Vote_saveStaffComment=function(a,b){$("#staff-comment-button").val("Saving...").attr("disabled",true);$.ajax({type:"POST",url:domain+"/json/feature-staffcomment.json",dataType:"json",timeout:timeoutsec*1E3,data:{feature_id:a,comment:b},success:function(c){$("#staff-comment-button").val("Save changes").attr("disabled",false);c.error==""?FList.Common_displayNotice("Staff comment saved."):FList.Common_displayError(c.error)},error:function(c,d,e){FList.Common_displayError("Error: "+d+", "+e)}})};
FList.Vote_addFeature=function(){$("#vote-feature-submit").val("Submitting...").attr("disabled",true);var a=$("#VarFeatureTitle").val(),b=$("#VarFeatureDescription").val(),c=$("#VarFeatureKeywords").val(),d=$("#VarFeatureSummary").val(),e=$("#VarCharacterId").val(),f=$("#VarFeatureCategory").val();$.ajax({type:"POST",url:domain+"/json/feature-add.json",dataType:"json",timeout:timeoutsec*1E3,data:{title:a,description:b,character_id:e,keywords:c,category:f,summary:d},success:function(g){$("#vote-feature-submit").attr("disabled",
false).val("Submit it!");if(g.error==""){$("#suggestions-new").before('<div class="feature panel VoteFeature'+g.feature_id+'"><div class="featurecontrols"><span class="upvote upvoted" onclick="CastVote('+g.feature_id+',true);">&nbsp;</span><span class="score" id="Feature'+g.feature_id+'Votes">1</span><span class="downvote" onclick="CastVote('+g.feature_id+',false);">&nbsp;</span></div><div class="featureident"><a href="'+domain+"c/"+g.friendlyname+'"><img src="'+staticdomain+"images/avatar/"+g.friendlyname+
'.png"/></a></div><div class="featuremain"><a class="VoteEditFeatureLink" onclick="FList.Vote_EditFeature('+g.feature_id+');"></a><span class="title"><a href="vote.php?fid='+g.feature_id+'">'+g.name+'</a> (0 comments)</span><div class="summary" style="clear:both;font-size:0.9em;">'+FList.TagParser.parseContent(htmlentities(g.summary))+"</span></div></div>");$("#ism").length>0||$("#isa");$(".feature:first .VoteEditFeatureLink").qtip({content:{text:"Edit this feature/suggestion."},style:{widget:true}});
$("#Content .VoteFeature"+g.feature_id).effect("highlight",{color:"#FFFFFF"},400);FList.Common_displayNotice("Your suggestion or feature request has been added!")}else FList.Common_displayError(g.error)},error:function(g,m,r){FList.Common_displayError("Error: "+m+", "+r)}})};FList.Vote_pending=false;
FList.Vote_CastVote=function(a,b){if(!FList.Vote_pending){FList.Vote_pending=true;$(".VoteFeature"+a+" .upvote").css("opacity","0.5");$(".VoteFeature"+a+" .downvote").css("opacity","0.5");var c=0;if($(".VoteFeature"+a+" span.upvote").hasClass("upvoted"))c=1;if($(".VoteFeature"+a+" span.downvote").hasClass("downvoted"))c=-1;var d=c;if(c==1&&b==true){$(".VoteFeature"+a+" span.upvote").removeClass("upvoted");d=0}if(c==-1&&b==false){$(".VoteFeature"+a+" span.downvote").removeClass("downvoted");d=0}if((c==
1||c==0)&&b==false){$(".VoteFeature"+a+" span.upvote").removeClass("upvoted");$(".VoteFeature"+a+" span.downvote").addClass("downvoted");d=-1}if((c==-1||c==0)&&b==true){$(".VoteFeature"+a+" span.downvote").removeClass("downvoted");$(".VoteFeature"+a+" span.upvote").addClass("upvoted");d=1}d==-1&&$(".VoteFeature"+a+" .featurecontrols").effect("highlight",{color:"#FF0000"},400);d==0&&$(".VoteFeature"+a+" .featurecontrols").effect("highlight",{color:"#FFFFFF"},400);d==1&&$(".VoteFeature"+a+" .featurecontrols").effect("highlight",
{color:"#00FF00"},400);setTimeout('FList.Vote_Send("'+a+'","'+d+'")',100)}};
FList.Vote_Send=function(a,b){$.ajax({url:domain+"/json/feature-vote.json",type:"POST",timeout:timeoutsec*1E3,data:{feature_id:a,type:b},success:function(c){if(c.error==""){$(".VoteFeature"+a+" span.score").html(c.score);$(".VoteFeature"+a+" span.score-total").html("u: "+c.upvotes+", d: "+c.downvotes)}else FList.Common_displayError(c.error);$(".VoteFeature"+a+" .upvote").css("opacity","1");$(".VoteFeature"+a+" .downvote").css("opacity","1");FList.Vote_pending=false}})};
FList.Vote_setState=function(a,b,c,d){$(".VoteFeature"+a+" .state").attr("disabled",true);$.ajax({url:domain+"/json/feature-setstate.json",type:"POST",timeout:timeoutsec*1E3,data:{feature_id:a,state:b},success:function(e){$(".VoteFeature"+a+" .state").attr("disabled",false);if(e.error=="")typeof c!=="undefined"&&c(e);else typeof d!=="undefined"?d(e.error):FList.Common_displayError(e.error)}})};
FList.Vote_init=function(){$("#staff-comment-button").button();$(".VoteTickFeatureLink").qtip({content:{text:"Mark this feature/suggestion as implemented."},style:{widget:true}});$(".VoteLockFeatureLink").qtip({content:{text:"Lock this feature/suggestion for further comments or voting."},style:{widget:true}});$(".VoteKillFeatureLink").qtip({content:{text:"Remove this feature/suggestion entirely."},style:{widget:true}});$(".VoteEditFeatureLink").qtip({content:{text:"Edit this feature/suggestion."},
style:{widget:true}});FList.Vote_featureeditdialog=$('<div class="StyledForm"><p><span class="label">Title</span><span class="element"><input type="text"  class="Textbox" id="EditFeatureTitle"/></span></p><br/><p><span class="label">Summary</span><span class="element"><input type="text"  class="Textbox" id="EditFeatureSummary" maxlength="255"/></span></p><br/><p><span class="label">Keywords</span><span class="element"><input type="text"  class="Textbox" id="EditFeatureKeywords" maxlength="255"/></span></p><br/><p><span class="label">Category</span><span class="element"><select class="select" id="EditFeatureCategory"><option>F-Chat feature request</option><option>F-Chat suggestion</option><option>F-Chat channel request</option><option>General suggestion</option><option>General feature request</option><option>F-List suggestion</option><option>F-List feature request</option><option>Kink/profile suggestions</option><option>Misc/Other</option></select></span></p><br/><b>Description</b><br/><textarea id="EditFeatureDescription" style="width:300px;" maxlength="32000"></textarea></div>');
FList.Vote_featureeditdialog.dialog({title:"Edit suggestion",width:500,height:500,autoOpen:false,modal:true,buttons:[{text:"Save",click:function(){var a=$("#EditFeatureTitle").val(),b=$("#EditFeatureDescription").val(),c=$("#EditFeatureSummary").val(),d=$("#EditFeatureKeywords").val(),e=$("#EditFeatureCategory").val();$.ajax({url:domain+"/json/feature-update.json",type:"POST",timeout:timeoutsec*1E3,data:{feature_id:FList.Vote_activefeature,name:a,description:b,summary:c,keywords:d,category:e},success:function(f){if(f.error==
""){$(".VoteFeature"+FList.Vote_activefeature+" .title").html("<a href='vote.php?fid="+FList.Vote_activefeature+"'>"+a+"</a> ("+f.commentcount+" comments)");$(".VoteFeature"+FList.Vote_activefeature+" .category").html(e);$(".VoteFeature"+FList.Vote_activefeature+" .description").html(FList.TagParser.parseContent(htmlentities(b)));$(".VoteFeature"+FList.Vote_activefeature+" .summary").html(FList.TagParser.parseContent(htmlentities(c)));$(".VoteFeature"+FList.Vote_activefeature+".description").effect("highlight",
{color:"#FFFFFF"},400);$(".VoteFeature"+FList.Vote_activefeature+".title").effect("highlight",{color:"#FFFFFF"},400);$(".VoteFeature"+FList.Vote_activefeature+".summary").effect("highlight",{color:"#FFFFFF"},400)}else FList.Common_displayError(f.error)}});$(this).dialog("close")}},{text:"Cancel",click:function(){$(this).dialog("close")}}]})};
FList.Vote_KillFeature=function(a){if(confirm("Are you sure you want to permanently delete this item?")){$.ajax({url:domain+"/json/feature-delete.json",type:"POST",timeout:timeoutsec*1E3,data:{feature_id:a},success:function(b){b.error!=""&&FList.Common_displayError(b.error)}});$(".VoteFeature"+a+" .featurecontrols").effect("highlight",{color:"#FF0000"},400,function(){$(".VoteFeature"+a).css("opacity","0.5");$(".VoteFeature"+a+" .featurecontrols").children().remove()})}};
FList.Vote_featureeditdialog=0;FList.Vote_activefeature=0;FList.Vote_EditFeature=function(a){FList.Vote_activefeature=a;$.ajax({url:domain+"/json/feature-get.json",type:"POST",timeout:timeoutsec*1E3,data:{feature_id:a},success:function(b){if(b.error==""){$("#EditFeatureDescription").val(b.description);$("#EditFeatureTitle").val(b.name);$("#EditFeatureSummary").val(b.summary);$("#EditFeatureKeywords").val(b.keywords);$("#EditFeatureCategory").val(b.category);FList.Vote_featureeditdialog.dialog("open")}else FList.Common_displayError(b.error)}})};FList.Subfetish={init:function(){$(".Characterdata_FetishMessageBox").hide();FList.Subfetish.loadUi();for(i in FList.Subfetish.Data.SubfetishesByCustom){var a=FList.Subfetish.Data.SubfetishesByCustom[i];for(j in a){FList.Subfetish.Data.Fetishes[a[j]].isSubfetish=true;FList.Subfetish.Ext.lockFetish(a[j],i)}FList.Subfetish.Data.sortSubfetishes(i)}FList.Subfetish.Ui.redraw();FList.Subfetish.Ui.showMessage("kinks","Pick a kink group")},loadUi:function(){$("#subfetishConfig #groups").change(function(){FList.Subfetish.Ui.populateKinks();
FList.Subfetish.Ui.Lists.Cache.recache("groups")});$("#subfetishConfig #kinks").change(function(){FList.Subfetish.Ui.Lists.Cache.recache("kinks")});$("#subfetishConfig #customKinks").change(function(){FList.Subfetish.Ui.populateSubfetishes();FList.Subfetish.Ui.Lists.Cache.recache("customKinks")});$("#subfetishConfig #subkinks").change(function(){FList.Subfetish.Ui.Lists.Cache.recache("subkinks")});$("#subfetishConfig #kinks").mouseenter(function(){$("#subfetishConfig #kinks option").mouseover(function(){if($(this).val()!=
"null"){$(this).addClass("kinkHover");FList.Subfetish.Ui.describe($(this).val(),FList.Subfetish.Ui.Lists.customGroupSelected()?"custom":"default")}});$("#subfetishConfig #kinks option").mouseleave(function(){$(this).removeClass("kinkHover")})});$("#subfetishConfig #customKinks").mouseenter(function(){$("#subfetishConfig #customKinks option").mouseover(function(){if(!FList.Subfetish.Ui.Lists.isEmpty("#customKinks")){FList.Subfetish.Ui.describe($(this).val(),"custom");$(this).addClass("kinkHover")}});
$("#subfetishConfig #customKinks option").mouseleave(function(){$(this).removeClass("kinkHover")})});$("#subfetishConfig #subkinks").mouseenter(function(){$("#subfetishConfig #subkinks option").mouseover(function(){if($(this).val()!="null"){$(this).addClass("kinkHover");FList.Subfetish.Ui.describe($(this).val(),$(this).hasClass(FList.Subfetish.Data.class_Custom)?"custom":"default")}});$("#subfetishConfig #subkinks option").mouseleave(function(){$(this).removeClass("kinkHover")})});$("#subfetishConfig #addAll").click(function(){$("#subfetishConfig #kinks option").each(function(){$(this).attr("selected",
"selected")});$("#subfetishConfig #addKink").click()});$("#subfetishConfig #addKink").click(function(){var a=FList.Subfetish.Ui.Lists.currentCustomFetish();if(isNaN(a))FList.Subfetish.Ui.reportError("No custom fetish selected");else if(isNaN(FList.Subfetish.Ui.Lists.currentGroup()))FList.Subfetish.Ui.reportError("No kink group selected");else{var b=FList.Subfetish.Ui.Lists.selectedFetishes();b.length<1||FList.Subfetish.Ui.Lists.isEmpty("#kinks")?FList.Subfetish.Ui.reportError("No kinks are selected"):
FList.Subfetish.Data.addSubfetishes(b,a)}});$("#subfetishConfig #removeSubkink").click(function(){var a=FList.Subfetish.Ui.Lists.currentCustomFetish();if(isNaN(a))FList.Subfetish.Ui.reportError("No custom fetish selected");else{var b=[];$("#subfetishConfig #subkinks option:selected").each(function(){b.push($(this).val())});b.length<1||FList.Subfetish.Ui.Lists.isEmpty("#subkinks")?FList.Subfetish.Ui.reportError("No subkinks are selected"):FList.Subfetish.Data.removeSubfetishes(b,a)}});$("#subfetishConfig #removeAll").click(function(){$("#subfetishConfig #subkinks option").each(function(){$(this).attr("selected",
"selected")});$("#subfetishConfig #removeSubkink").click()})}};
FList.Subfetish.Data={Groups:[],Fetishes:[],CustomFetishes:[],FetishesByGroup:[],SubfetishesByCustom:[],hasSubfetishes:function(a){a=FList.Subfetish.Data.SubfetishesByCustom[a];if(a==null)return null;return a.length>0},addSubfetish:function(a,b){var c=FList.Subfetish.Data.SubfetishesByCustom[b];if(c.indexOf(a)==-1){c.push(a);FList.Subfetish.Data.Fetishes[a].isSubfetish=true;FList.Subfetish.Ext.lockFetish(a,b);FList.Subfetish.Data.sortSubfetishes(b)}},addSubfetishes:function(a,b){for(i in a)FList.Subfetish.Data.addSubfetish(a[i],
b);FList.Subfetish.Ui.redraw()},removeSubfetish:function(a,b){var c=FList.Subfetish.Data.SubfetishesByCustom[b],d=c.indexOf(a);if(d!=-1){FList.Subfetish.Ext.unlockFetish(a,b);c.splice(d,1);FList.Subfetish.Data.Fetishes[a].isSubfetish=false}},removeSubfetishes:function(a,b){if(FList.Subfetish.Data.hasSubfetishes(b)){for(i in a)FList.Subfetish.Data.removeSubfetish(a[i],b);FList.Subfetish.Ui.redraw()}},sortSubfetishes:function(a){FList.Subfetish.Data.SubfetishesByCustom[a].sort(FList.Subfetish.Data.subfetishSortFunc)},
subfetishSortFunc:function(a,b){if(!a||!b)return 0;a=FList.Subfetish.Data.Fetishes[a];b=FList.Subfetish.Data.Fetishes[b];if(a.name==b.name)return 0;if(a.name<b.name)return-1;if(a.name>b.name)return 1},setFetishChoice:function(a,b){FList.Subfetish.Data.Fetishes[a].choice=b;FList.Subfetish.Ui.redrawKinks()},recheckCustomChoice:function(a){var b=$("#CustomChoice"+a+" option:selected").val();FList.Subfetish.Data.setCustomChoice(a,b)},setCustomChoice:function(a,b){FList.Subfetish.Data.CustomFetishes[a].choice=
b;FList.Subfetish.Ui.redrawCustoms()},setCustomName:function(a,b){FList.Subfetish.Data.CustomFetishes[a].name=b;FList.Subfetish.Ui.redrawCustoms()},addCustom:function(a){a={id:a,name:"(New unnamed fetish)",description:"(No description)",choice:"fave",isNew:true};FList.Subfetish.Data.CustomFetishes[a.id]=a;FList.Subfetish.Data.SubfetishesByCustom[a.id]=[];FList.Subfetish.Ui.redrawCustoms()},removeCustom:function(a){FList.Subfetish.Data.removeSubfetishes(FList.Subfetish.Data.SubfetishesByCustom[a]);
delete FList.Subfetish.Data.CustomFetishes[a];delete FList.Subfetish.Data.SubfetishesByCustom[a];FList.Subfetish.Ui.redraw()}};
FList.Subfetish.Ext={lockFetish:function(a,b){var c="This is a subfetish of: "+FList.Subfetish.Data.CustomFetishes[parseInt(b)].name;$("#FetishItem"+a+" .Characterdata_FetishMessageBox").text(c);$("#FetishItem"+a+" .Characterdata_FetishMessageBox").show();$("#FetishItem"+a+" .Characterdata_FetishChoiceBox").hide()},unlockFetish:function(a){$("#FetishItem"+a+" .Characterdata_FetishMessageBox").hide();$("#FetishItem"+a+" .Characterdata_FetishChoiceBox").show()}};
FList.Subfetish.Ui={clearList:function(a){$("#subfetishConfig "+a).find("option").remove()},populateKinks:function(){FList.Subfetish.Ui.clearList("#kinks");var a=FList.Subfetish.Ui.Lists.topValueIn("#groups");if(isNaN(a))FList.Subfetish.Ui.showMessage("kinks","Pick a kink group");else{a=FList.Subfetish.Data.FetishesByGroup[a];for(i in a){var b=FList.Subfetish.Data.Fetishes[a[i]];FList.Subfetish.Data.Fetishes[b.id].isSubfetish||$("#subfetishConfig #kinks").append('<option value="'+b.id+'" class="'+
b.choice+'">'+b.name+"</option>")}FList.Subfetish.Ui.Lists.isEmpty("#kinks")?FList.Subfetish.Ui.showMessage("kinks","All kinks assigned",false):FList.Subfetish.Ui.hideMessage("kinks")}},populateCustoms:function(){FList.Subfetish.Ui.clearList("#customKinks");var a=FList.Subfetish.Data.CustomFetishes;for(i in a){var b=a[i];$("#subfetishConfig #customKinks").append('<option value="'+b.id+'" class="'+b.choice+'">'+b.name+"</option>")}FList.Subfetish.Ui.Lists.isEmpty("#customKinks")?FList.Subfetish.Ui.showMessage("customKinks",
"You need custom kinks in order to use this feature. Create some!",false):FList.Subfetish.Ui.hideMessage("customKinks")},populateSubfetishes:function(){FList.Subfetish.Ui.clearList("#subkinks");var a=FList.Subfetish.Ui.Lists.topValueIn("#customKinks");if(isNaN(a))FList.Subfetish.Ui.showMessage("subkinks","Pick a custom kink to create subkinks");else{var b=FList.Subfetish.Data.SubfetishesByCustom[a];if(b==null||b.length==0)FList.Subfetish.Ui.showMessage("subkinks","No subkinks",false);else{for(i in b){var c=
FList.Subfetish.Data.Fetishes[b[i]],d=FList.Subfetish.Data.CustomFetishes[a];$("#subfetishConfig #subkinks").append('<option class="'+d.choice+'" value="'+c.id+'">'+c.name+"</option>")}FList.Subfetish.Ui.hideMessage("subkinks")}}},redrawKinks:function(){FList.Subfetish.Ui.populateKinks();FList.Subfetish.Ui.reselect("kinks");FList.Subfetish.Ui.Lists.Cache.recache()},redrawCustoms:function(){FList.Subfetish.Ui.populateCustoms();FList.Subfetish.Ui.reselect("customKinks");FList.Subfetish.Ui.populateSubfetishes();
FList.Subfetish.Ui.reselect("subkinks");FList.Subfetish.Ui.Lists.Cache.recache()},redraw:function(){FList.Subfetish.Ui.populateKinks();FList.Subfetish.Ui.reselect("kinks");FList.Subfetish.Ui.populateCustoms();FList.Subfetish.Ui.reselect("customKinks");FList.Subfetish.Ui.populateSubfetishes();FList.Subfetish.Ui.reselect("subkinks");FList.Subfetish.Ui.Lists.Cache.recache()},reselect:function(a){var b=FList.Subfetish.Ui.Lists.Cache[a];$("#subfetishConfig #"+a+" option:selected").each(function(){$(this).removeAttr("selected")});
var c=$("#subfetishConfig #"+a+" option").length;for(j in b){var d=b[j];if(d>=c)break;$("#subfetishConfig #"+a+" option").eq(d).attr("selected","selected")}},reportError:function(a){$("#subfetishConfig #debugerrors").text(a)},describe:function(a,b){fetish=b=="default"?FList.Subfetish.Data.Fetishes[a]:FList.Subfetish.Data.CustomFetishes[a];$("#subfetishConfig #description #title").text(fetish.name);$("#subfetishConfig #description #content").text(fetish.description)},showMessage:function(a,b,c){var d=
"#subfetishConfig #"+a+"Message";a="#subfetishConfig #"+a;if(c!=false)b+="<br />&#x2190;";$(d).html(b);$(d).show();$(a).hide()},hideMessage:function(a){var b="#subfetishConfig #"+a;$("#subfetishConfig #"+a+"Message").hide();$(b).show()}};
FList.Subfetish.Ui.Lists={customGroupSelected:function(){return parseInt(FList.Subfetish.Ui.Lists.currentGroup())==-1},currentGroup:function(){return FList.Subfetish.Ui.Lists.topValueIn("#groups")},currentCustomFetish:function(){return FList.Subfetish.Ui.Lists.topValueIn("#customKinks")},topValueIn:function(a){return parseInt($("#subfetishConfig "+a+" option:selected").val())},selectedFetishes:function(){return FList.Subfetish.Ui.Lists.selectedValuesIn("#kinks")},selectedSubfetishes:function(){return FList.Subfetish.Ui.Lists.selectedValuesIn("#subkinks")},
selectedValuesIn:function(a){selected=[];$("#subfetishConfig "+a+" option:selected").each(function(){selected.push($(this).val())});return selected},isEmpty:function(a){return $("#subfetishConfig "+a+" option").length<1}};
FList.Subfetish.Ui.Lists.Cache={kinks:[],customKinks:[],subkinks:[],recache:function(a){a||(a=["kinks","customKinks","subkinks"]);if(typeof a!="object")a=[a];for(i in a){var b=a[i],c=[];$("#subfetishConfig #"+b+" option").each(function(d){$(this).is(":selected")&&c.push(d)});FList.Subfetish.Ui.Lists.Cache[b]=c}}};FList.Subfetish.Saving={save:function(){FList.Subfetish.Saving.jsonify();$("#saveform").submit()},jsonify:function(){var a=JSON.stringify(FList.Subfetish.Data.SubfetishesByCustom);$("#subfetishConfig #subfetish_json").val(a)}};
FList.Character_expandSubs=function(a){var b="#Character_CustomFetish"+a;a="#Character_SubfetishList"+a;var c,d;if($(b).hasClass("Closed")){c="Closed";d="Open"}else{c="Open";d="Closed"}$(b).removeClass(c);$(a).removeClass(c);$(b).addClass(d);$(a).addClass(d)};
'''